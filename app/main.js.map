{"version":3,"file":"main.js","sources":["../src/js/main/reducers.js","../src/js/main/Store.js","../src/js/shared/utils.js","../src/js/main/watcher/mapDocument.js","../src/js/main/watcher/mapMedia.js","../src/js/main/watcher/mapFolder.js","../src/js/main/watcher/mapProject.js","../src/js/main/watcher/Watcher.js","../src/js/main/DiskManager.js","../src/js/main/actions/deleteFile.js","../src/js/main/actions/deleteFiles.js","../src/js/main/actions/saveFile.js","../src/js/main/actions/setProjectPath.js","../src/js/main/IpcManager.js","../src/js/main/MenuBarManager.js","../src/js/main/WindowManager.js","../src/js/main/main.js"],"sourcesContent":["import { BrowserWindow } from 'electron'\nimport produce, { enablePatches } from 'immer'\nimport { newProject } from './Store.js'\nimport { existsSync, pathExistsSync, accessSync } from 'fs-extra'\nimport fs from 'fs'\n\nenablePatches()\n\nexport const update = (state, action, windowId) =>\n  produce(state, (draft) => {\n\n    // Set a few useful, commonly-used variables\n    const win = windowId !== undefined ? BrowserWindow.fromId(windowId) : undefined\n    const project = windowId !== undefined ? draft.projects.find((p) => p.window.id == windowId) : undefined\n\n    switch (action.type) {\n\n      // -------- APP -------- //\n\n      case 'START_COLD_START': {\n\n        // Update appStatus\n        draft.appStatus = 'coldStarting'\n\n        // If there are existing projects, check their directories. Prune any that 1) are missing a directory (blank value, or path doesn't exist), or 2) that we don't have write permissions for.\n        if (draft.projects.length) {\n          draft.projects = draft.projects.filter((project) => {\n            if (!project.directory) return false\n            try {\n              accessSync(project.directory, fs.constants.W_OK)\n              return true\n            } catch(err) {\n              return false\n            }\n          })\n        }\n\n        // If there are no projects, create a new empty one.\n        if (!draft.projects.length) {\n          draft.projects.push(createNewProject())\n        }\n\n        break\n      }\n\n      case 'FINISH_COLD_START': {\n        draft.appStatus = 'open'\n        break\n      }\n\n      case 'START_TO_QUIT': {\n        draft.appStatus = 'wantsToQuit'\n        break\n      }\n\n      case 'CAN_SAFELY_QUIT': {\n        draft.appStatus = 'safeToQuit'\n        break\n      }\n\n\n      // -------- PROJECT/WINDOW: CREATE AND CLOSE -------- //\n\n      case 'CREATE_NEW_PROJECT': {\n        createNewProject(draft)\n        break\n      }\n\n      case 'SET_PROJECT_DIRECTORY': {\n\n        project.directory = action.directory\n        break\n      }\n\n      case 'OPENED_WINDOW': {\n        // Update window status\n        const project = draft.projects[action.projectIndex]\n        project.window.status = 'open'\n        project.window.id = windowId\n        break\n      }\n\n      case 'START_TO_CLOSE_WINDOW': {\n        project.window.status = 'wantsToClose'\n        break\n      }\n\n      case 'CAN_SAFELY_CLOSE_WINDOW': {\n        project.window.status = 'safeToClose'\n        break\n      }\n\n      case 'REMOVE_PROJECT': {\n        const projects = draft.projects.slice(0)\n        const indexOfProjectToRemove = projects.findIndex((p) => p.window.id == windowId)\n        projects.splice(indexOfProjectToRemove, 1)\n        draft.projects = { ...projects }\n        break\n      }\n\n\n      // -------- PROJECT -------- //\n\n\n      // Directory\n\n      case 'SET_PROJECTPATH_SUCCESS': {\n        try {\n          // Is path valid, and can we write to it?\n          // See: https://nodejs.org/api/fs.html#fs_fs_accesssync_path_mode\n          accessSync(action.path, fs.constants.W_OK)\n          // If yes, proceed.\n          project.directory = action.path\n        } catch (err) {\n          // Else, do nothing.\n        }\n        break\n      }\n\n      case 'SET_PROJECTPATH_FAIL': {\n        // DO NOTHING\n        break\n      }\n\n      // UI\n\n      case 'SET_LAYOUT_FOCUS': {\n        project.focusedLayoutSection = action.section\n        break\n      }\n\n      // Window\n\n      // Save window bounds to state, so we can restore later\n      case 'SAVE_WINDOW_BOUNDS': {\n        project.window.bounds = action.windowBounds\n        break\n      }\n\n\n\n      // -------- SIDEBAR 2 -------- //\n\n      case 'SELECT_SIDEBAR_TAB_BY_ID': {\n        project.sidebar.activeTabId = action.id\n        break\n      }\n\n      case 'EXPAND_SIDEBAR_ITEMS': {\n        const tab = project.sidebar.tabsById[action.tabId]\n        tab.expanded = action.expanded\n        break\n      }\n\n      case 'SELECT_SIDEBAR_ITEMS': {\n        const tab = project.sidebar.tabsById[action.tabId]\n        tab.lastSelected = action.lastSelected\n        tab.selected = action.selected\n        break\n      }\n\n      case 'SELECT_SIDEBAR_TAB_BY_INDEX': {\n        project.sidebar.activeTabId = project.sidebar.tabsAll[action.index]\n        break\n      }\n      case 'TOGGLE_SIDEBAR_PREVIEW': {\n        project.sidebar.isPreviewOpen = !project.sidebar.isPreviewOpen\n        break\n      }\n\n    }\n  }, (patches) => {\n    // Update `global.patches`\n    global.patches = patches\n  })\n\n\n\n/**\n* Each project needs to store the ID of the window it's associated with. The BrowserWindow hasn't been created yet for this project (that's handled by WindowManager), but we know what ID the window will be: BrowserWindow ids start at 1 and go up. And removed BrowserWindows do not release their IDs back into the available set. So the next BrowserWindow id is always +1 of the highest existing.\n*/\nfunction getNextWindowId() {\n  const existingWindowIds = BrowserWindow.getAllWindows()\n    .map((win) => win.id)\n  const nextWindowId = Math.max(existingWindowIds) + 1\n  return nextWindowId\n}\n\n/**\n * Insert a new blank project into state.projects array\n */\nfunction createNewProject() {\n  const project = { ...newProject }\n  project.window.id = getNextWindowId()\n  return project\n}\n","import { app, BrowserWindow } from 'electron'\nimport ElectronStore from 'electron-store'\nimport { update } from './reducers'\n\nimport colors from 'colors'\n\n\nexport class Store extends ElectronStore {\n  constructor() {\n    // Note: `super` lets us access and call functions on object's parent (MDN)\n    // We pass in our config options for electron-store\n    // Per: https://github.com/sindresorhus/electron-store#options\n    super({\n      name: \"store\",\n      defaults: storeDefault\n      // schema: StoreSchema\n    })\n  }\n\n  async dispatch(action, windowId = undefined) {\n\n    if (!app.isPackaged) logTheAction(action)\n\n    // Get next state. \n    // `update` function also updates `global.patches`.\n    const nextState = update(store.store, action, windowId)\n\n    // Apply next state to Store\n    this.set(nextState)\n\n    // Send patches to render proces\n    const windows = BrowserWindow.getAllWindows()\n    if (windows.length) {\n      windows.forEach((win) => win.webContents.send('statePatchesFromMain', global.patches))\n    }\n  }\n}\n\nfunction logTheAction(action) {\n  console.log(\n    // `Action:`.bgBrightGreen.black,\n    `${action.type}`.bgBrightGreen.black.bold,\n    // `(Store.js)`.green\n  )\n}\n\nconst storeDefault = {\n\n  // ----------- APP ----------- //\n\n  appStatus: 'open',\n\n  // App theme. See Readme.\n  appearance: {\n    userPref: 'match-system',\n    theme: 'gambier-light',\n  },\n\n  timing: {\n    treeListFolder: 300,\n  },\n\n  // ----------- PROJECTS ----------- //\n\n  projects: []\n\n}\n\nexport const newProject = {\n\n  window: {\n    // Used to associate windows with projects\n    id: 0,\n    // Used when closing window (to check if it's safe to do so or not)\n    status: 'open',\n    bounds: { x: 0, y: 0, width: 1600, height: 1200 }\n  },\n\n  // User specified directory to folder containing their project files\n  directory: '',\n\n  // User specified path to CSL-JSON file containing their citatons\n  citations: '',\n\n  focusedLayoutSection: 'sidebar',\n\n  // A copy of the object of the document currently visible in the editor.\n  openDoc: {},\n\n  // SideBar\n  sidebar: {\n    isOpen: true,\n    isPreviewOpen: true,\n    activeTabId: 'project',\n    width: 250,\n    tabsById: {\n      project: {\n        title: 'Project',\n        lastSelected: {}, // id\n        selected: [], // Array of ids\n        expanded: [], // Array of folder ids\n      },\n      allDocs: {\n        title: 'All Documents',\n        lastSelected: {},\n        selected: [],\n      },\n      mostRecent: {\n        title: 'Most Recent',\n        lastSelected: {},\n        selected: [],\n      },\n      tags: {\n        title: 'Tags',\n        lastSelected: {},\n        selected: [],\n      },\n      media: {\n        title: 'Media',\n        lastSelected: {},\n        selected: [],\n      },\n      citations: {\n        title: 'Citations',\n        lastSelected: {},\n        selected: [],\n      },\n      search: {\n        title: 'Search',\n        lastSelected: {},\n        selected: [],\n      }\n    },\n    tabsAll: ['project', 'allDocs', 'mostRecent', 'tags', 'media', 'citations', 'search']\n  }\n}\n","import deepEql from 'deep-eql'\n\n/**\n * Get file size in KB, MB, GB, or TB (whatever is closest), from bytes.\n * From: https://gist.github.com/lanqy/5193417#gistcomment-3240729\n * @param {*} bytes\n * @param {*} separator \n * @param {*} postFix \n */\nexport function prettySize(bytes, separator = ' ', postFix = '') {\n  if (bytes) {\n      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\n      const i = Math.min(parseInt(Math.floor(Math.log(bytes) / Math.log(1024)).toString(), 10), sizes.length - 1);\n      return `${(bytes / (1024 ** i)).toFixed(i ? 1 : 0)}${separator}${sizes[i]}${postFix}`;\n  }\n  return 'n/a';\n}\n\nconst formats = {\n  document: ['.md', '.markdown'],\n  image: [\n    '.apng', '.bmp', '.gif', '.jpg', '.jpeg', '.jfif', '.pjpeg', '.pjp', '.png', '.svg', '.tif', '.tiff', '.webp'\n  ],\n  av: [\n    '.flac', '.mp4', '.m4a', '.mp3', '.ogv', '.ogm', '.ogg', '.oga', '.opus', '.webm'\n  ]\n}\n\nexport function isDoc(fileExtension) {\n  return formats.document.includes(fileExtension)\n}\n\nexport function isMedia(fileExtension) {\n  const isImage = formats.image.includes(fileExtension)\n  const isAV = formats.av.includes(fileExtension)\n  return isImage || isAV\n}\n\nexport function getMediaType(fileExtension) {\n  const isImage = formats.image.includes(fileExtension)\n  const isAV = formats.av.includes(fileExtension)\n  if (isImage) {\n    return 'img'\n  } else if (isAV) {\n    return 'av'\n  } else {\n    console.error('File extension does not match supported media types')\n  }\n}\n\n/**\n * Return file type ('doc', 'img', 'av') based on file extension.\n * @param {*} fileExtension - String. E.g. 'gif'\n */\nexport function getFileType(fileExtension) {\n  if (isDoc(fileExtension)) {\n    return 'doc'\n  } else if (isMedia(fileExtension)) {\n    return getMediaType(fileExtension)\n  }\n}\n\nexport function findInTree (tree, value, key = 'id', reverse = false) {\n  const stack = [ tree[0] ]\n  while (stack.length) {\n    const node = stack[reverse ? 'pop' : 'shift']()\n    if (node[key] === value) return node\n    node.children && stack.push(...node.children)\n  }\n  return null\n}\n\nexport function stringify(value) {\n  return JSON.stringify(value, null, '\\t')\n}\n\nfunction extractKeysFromString(keyAsString) {\n\t// Convert propAddress string to array of keys\n  // Before: \"projects[5].window\"\n  // After: [\"projects\", 5, \"window\"]\n  const regex = /[^\\.\\[\\]]+?(?=\\.|\\[|\\]|$)/g\n  const keys = keyAsString.match(regex)\n  if (keys && keys.length) {\n    keys.forEach((p, index, thisArray) => {\n      // Find strings that are just integers, and convert to integers\n      if (/\\d/.test(p)) {\n        thisArray[index] = parseInt(p, 10)\n      }\n    })\n  }\n  return keys\n}\n\n/**\n * Check if a state property has changed, and (optional) if it equals a specified value. Determine by checking latest state patches (returned by Immer). For each patch, check if `path` array contains specified `props`, and if `value` value equals specified `toValue`.\n * @param {*} props - Either a string, or an array (for more precision)/\n * @param {*} [toValue] - Optional value to check prop against\n */\nexport function propHasChanged(props, toValue = '') {\n\treturn global.patches.some((patch) => {\n\n  \tconst pathAsString = patch.path.toString()\n\t\tconst checkMultipleProps = Array.isArray(props)\n\n\t\tconst hasChanged = checkMultipleProps ?\n    \tprops.every((key) => pathAsString.includes(key)) :\n      pathAsString.includes(props)\n    \n    // If optional 'toValue' argument is specified, check it.\n    // Else, only check `hasChanged`\n    if (toValue) {\n      const equalsValue = patch.value == toValue\n      return hasChanged && equalsValue\n    } else {\n      return hasChanged\n    }\n  })\n}\n\n\n\n\nconst getNestedObject = (nestedObj, pathArr) => {\n\treturn pathArr.reduce((obj, key) =>\n\t\t(obj && obj[key] !== 'undefined') ? obj[key] : undefined, nestedObj);\n}\n\nexport function hasChanged(keysAsString = undefined, objA, objB) {\n  if (keysAsString && keysAsString !== '*') {\n    const keys = extractKeysFromString(keysAsString)\n    const objAVal = getNestedObject(objA, keys)\n    const objBVal = getNestedObject(objB, keys)\n    if (objAVal == undefined || objBVal == undefined) {\n      // If either is undefined, return undefined\n      return undefined\n    } else if (typeof objAVal == 'object' && typeof objBVal == 'object') {\n      // If both are objects, do a deep object comparison\n      return !deepEql(objAVal, objBVal)\n    } else {\n      // Else, compare values\n      return objAVal !== objBVal\n    }\n  } else {\n    return !deepEql(objA, objB)\n  }\n}\n\nexport function hasChangedTo(keysAsString, value, objTo, objFrom) {\n  if (!keysAsString || !value ) {\n    // If either required arguments are missing or empty, return undefined\n    return undefined\n  } else {\n    const keys = extractKeysFromString(keysAsString)\n    const objToVal = getNestedObject(objTo, keys)\n    const objFromVal = getNestedObject(objFrom, keys)\n    if (typeof objToVal == 'object' || typeof objFromVal == 'object') {\n      // If either value is an object, return undefined.\n      // For now, we don't allow checking against objects.\n      return undefined\n    } else if (objToVal === objFromVal) {\n      // If no change, return false\n      return false\n    } else {\n      // Else, check if objTo equals value\n      return objToVal === value\n    }\n  }\n}\n\n\n","import { stat } from 'fs-extra'\nimport matter from 'gray-matter'\nimport removeMd from 'remove-markdown'\nimport path from 'path'\nimport { getMediaType } from '../../shared/utils'\n\n/**\n * For specified path, return document details\n */\nexport async function mapDocument (filepath, parentId, nestDepth, stats = undefined) {\n\n\tif (stats == undefined) stats = await stat(filepath)\n\n\tconst doc = {\n\t\ttype: 'doc',\n\t\tname: '',\n\t\tpath: filepath,\n\t\tid: `doc-${stats.ino}`,\n\t\tparentId: parentId,\n\t\tcreated: stats.birthtime.toISOString(),\n\t\tmodified: stats.mtime.toISOString(),\n\t\tnestDepth: nestDepth,\n\t\t// --- Doc-specific --- //\n\t\ttitle: '',\n\t\texcerpt: '',\n\t\ttags: [],\n\t}\t\n\n\t// Get front matter\n\tconst gm = matter.read(filepath)\n\n\t// Set excerpt\n\t// `md.contents` is the original input string passed to gray-matter, stripped of front matter.\n\tdoc.excerpt = getExcerpt(gm.content)\n\n\t// Set fields from front matter (if it exists)\n\t// gray-matter `isEmpty` property returns \"true if front-matter is empty\".\n\tconst hasFrontMatter = !gm.isEmpty\n\tif (hasFrontMatter) {\n\t\t// If `tags` exists in front matter, use it. Else, set as empty `[]`.\n\t\tdoc.tags = gm.data.hasOwnProperty('tags') ? gm.data.tags : []\n\t}\n\n\t// Set title. E.g. \"Sea Level Rise\"\n\tdoc.title = getTitle(gm, path.basename(filepath))\n\tdoc.name = doc.title\n\n\treturn doc\n\n\t// if (oldVersion !== undefined) {\n\t//   const lhs = Object.assign({}, oldVersion)\n\t//   const rhs = file\n\t//   diff.observableDiff(lhs, rhs, (d) => {\n\t//     if (d.kind !== 'D') {\n\t//       diff.applyChange(lhs, rhs, d)\n\t//     }\n\t//   })\n\t//   return lhs\n\t// } else {\n\t// }\n}\n\n/**\n * Set title, in following order of preference:\n * 1. From first h1 in content\n * 2. From `title` field of front matter\n * 3. From filename, minus extension\n */\nfunction getTitle(graymatter, filename) {\n\n\tlet titleFromH1 = graymatter.content.match(/^# (.*)$/m)\n\tif (titleFromH1) {\n\t\treturn titleFromH1[1]\n\t} else if (graymatter.data.hasOwnProperty('title')) {\n\t\treturn graymatter.data.title\n\t} else {\n\t\treturn filename.slice(0, filename.lastIndexOf('.'))\n\t}\n}\n\n/**\n * Return excerpt from content, stripped of markdown characters.\n * Per: https://github.com/jonschlinkert/gray-matter#optionsexcerpt\n * @param {*} file \n */\nfunction getExcerpt(content) {\n\n\t// Remove h1, if it exists. Then trim to 200 characters.\n\tlet excerpt = content\n\t\t.replace(/^# (.*)\\n/gm, '')\n\t\t.substring(0, 400)\n\n\t// Remove markdown formatting. Start with remove-markdown rules.\n\t// Per: https://github.com/stiang/remove-markdown/blob/master/index.js\n\t// Then add whatever additional changes I want (e.g. new lines).\n\texcerpt = removeMd(excerpt)\n\t\t.replace(/^> /gm, '')         // Block quotes\n\t\t.replace(/^\\n/gm, '')         // New lines at start of line (usually doc)\n\t\t.replace(/\\n/gm, ' ')         // New lines in-line (replace with spaces)\n\t\t.replace(/\\t/gm, ' ')         // Artifact left from list replacement\n\t\t.replace(/\\[@.*?\\]/gm, '')    // Citations\n\t\t.replace(/:::.*?:::/gm, ' ')  // Bracketed spans\n\t\t.replace(/\\s{2,}/gm, ' ')     // Extra spaces\n\t\t.substring(0, 200)            // Trim to 200 characters\n\n\treturn excerpt\n}","import { stat } from 'fs-extra'\nimport path from 'path'\nimport { getMediaType } from '../../shared/utils'\nimport sizeOf from 'image-size'\n\n/**\n * For specified path, return document details\n */\nexport async function mapMedia (filepath, parentId, nestDepth, stats = undefined) {\n\n\tif (stats == undefined) stats = await stat(filepath)\n\tconst extension = path.extname(filepath)\n\tconst type = getMediaType(extension)\n\tconst { width, height, type: format } = sizeOf(filepath)\n\n\treturn {\n\t\ttype: type,\n\t\tname: path.basename(filepath),\n\t\tpath: filepath,\n\t\tid: `${type}-${stats.ino}`,\n\t\tparentId: parentId,\n\t\tcreated: stats.birthtime.toISOString(),\n\t\tmodified: stats.mtime.toISOString(),\n\t\tnestDepth: nestDepth,\n\t\t// --- Media-specific --- //\n\t\tformat: format,\n\t\tsizeInBytes: stats.size,\n\t\tdimensions: { width: width, height: height },\n\t}\n}","import { stat, readdir } from 'fs-extra'\nimport path from 'path'\nimport { mapDocument } from './mapDocument'\nimport { mapMedia } from './mapMedia'\nimport { isDoc, isMedia, getMediaType } from '../../shared/utils.js'\n// import colors from 'colors'\n\n\n/**\n * For specified folder path, map the folder and it's child  \n * documents, media, and citations, and return `contents` object\n * with four arrays (one for each type).\n * @param {*} files - Reference to shared object we write changes to, and then return\n * @param {*} parentTreeItem - Tree item to add self to\n * @param {*} folderPath - Path to map\n * @param {*} stats - Optional. Can pass in stats, or if undefined, will get them in function.\n * @param {*} parentId - Optional. If undefined, we regard the folder as `root`\n * @param {*} nestDepth - Optional.\n */\nexport async function mapFolder(files, parentTreeItem, folderPath, stats = undefined, parentId = '', nestDepth = 0) {\n\n  // -------- New Folder -------- //\n\n  if (!stats) stats = await stat(folderPath)\n\n  // Create and populate new folder\n  const folder = {\n    type: 'folder',\n    name: folderPath.substring(folderPath.lastIndexOf('/') + 1),\n    path: folderPath,\n    id: `folder-${stats.ino}`,\n    parentId: parentId,\n    created: stats.birthtime.toISOString(),\n    modified: stats.mtime.toISOString(),\n    nestDepth: nestDepth,\n    // --- Folder-specific --- //\n    numChildren: 0,\n    numDescendants: 0,\n  }\n\n  // Add to `files`\n  files.byId[folder.id] = folder\n  files.allIds.push(folder.id)\n\n  // Populate tree details\n  const treeItem = {\n    id: folder.id,\n    parentId: parentId,\n    children: []\n  }\n  parentTreeItem.push(treeItem)\n\n\n  // -------- Contents -------- //\n\n  // Get everything in directory with `readdir`.\n  // Returns array of `fs.Dirent` objects.\n  // https://nodejs.org/api/fs.html#fs_class_fs_dirent\n  const directoryContents = await readdir(folderPath, { withFileTypes: true })\n\n  await Promise.all(\n    directoryContents.map(async (f) => {\n\n      // Get path by combining folderPath with file name.\n      const filepath = path.join(folderPath, f.name)\n\n      // Get extension\n      const ext = path.extname(f.name)\n\n      if (f.isDirectory()) {\n\n        const { numDescendants } = await mapFolder(files, treeItem.children, filepath, undefined, folder.id, nestDepth + 1)\n\n        // Increment child counters\n        folder.numChildren++\n        folder.numDescendants += numDescendants\n\n      } else if (isDoc(ext) || isMedia(ext)) {\n\n        const file = isDoc(ext) ? \n          await mapDocument(filepath, folder.id, nestDepth + 1) : \n          await mapMedia(filepath, folder.id, nestDepth + 1)\n\n        files.byId[file.id] = file\n        files.allIds.push(file.id)\n        treeItem.children.push({\n          id: file.id,\n          parentId: folder.id,\n        })\n\n        // Increment child counters\n        folder.numChildren++\n      }\n    })\n  )\n\n  folder.numDescendants += folder.numChildren\n\n  return {\n    numDescendants: folder.numDescendants\n  }\n}","import { mapFolder } from './mapFolder'\nimport { isWorkingPath } from '../utils-main'\n\n/**\n * Map project path recursively and dispatch results to store\n * @param {*} projectPath \n */\nexport async function mapProject (projectPath) {\n\n  // await isWorkingPath(directory)\n  // if (!isWorkingPath) {\n  //   console.error('directory is not valid')\n  // }\n\n  try {\n\n    const files = {\n      tree: [],\n      byId: {},\n      allIds: []\n    }\n\n    // Map project path, recursively\n    await mapFolder(files, files.tree, projectPath)\n    \n    return files\n    \n    // console.log(JSON.stringify(files, null, 2))\n\n  } catch (err) {\n    console.log(err)\n  }\n}","import { BrowserWindow } from 'electron'\nimport chokidar from 'chokidar'\nimport path from 'path'\nimport { pathExists } from 'fs-extra'\nimport produce, { enablePatches } from 'immer'\nimport { mapProject } from './mapProject'\nimport { mapDocument } from './mapDocument'\nimport { mapMedia } from './mapMedia'\nimport { findInTree, getFileType, isDoc, isMedia } from '../../shared/utils.js'\n\nenablePatches()\n\nexport class Watcher {\n  constructor(project) {\n    this.id = project.window.id\n    this.directory = project.directory\n    this.files = {}\n\n    // Start listening for directory value changes. Once user selects a project directory (e.g. in the first run experience), catch it \n\n    // Create listener for directory changes\n    global.store.onDidAnyChange((state, oldState) => {\n      \n      const directory = state.projects.find((p) => p.window.id == this.id).directory\n      const directoryIsDefined = directory !== ''\n      const directoryWasEmpty = this.directory == ''\n      const directoryHasChanged = directory !== this.directory\n\n      if (directoryIsDefined) {\n        if (directoryWasEmpty) {\n          this.directory = directory\n          this.start()\n        } else if (directoryHasChanged) {\n          this.update()\n        }\n      }\n    })\n\n    if (this.directory) {\n      this.start()\n    }\n  }\n\n  chokidarInstance = undefined\n  changes = []\n  changeTimer = undefined\n  directory = ''\n  files = {}\n  id = 0\n\n  async start() {\n\n    this.files = await mapProject(this.directory)\n    // console.log(JSON.stringify(this.files.tree, null, 2))\n    // Start watcher\n    this.chokidarInstance = chokidar.watch(this.directory, chokidarConfig)\n\n    // On any event, track changes. Some events include `stats`.\n    this.chokidarInstance\n      .on('change', (filePath) => this.batchChanges('change', filePath))\n      .on('add', (filePath) => this.batchChanges('add', filePath))\n      .on('unlink', (filePath) => this.batchChanges('unlink', filePath))\n      .on('addDir', (filePath) => this.batchChanges('addDir', filePath))\n      .on('unlinkDir', (filePath) => this.batchChanges('unlinkDir', filePath))\n\n    // Send initial files to browser window\n    const win = BrowserWindow.fromId(this.id)\n    win.webContents.send('initialFilesFromMain', this.files)\n  }\n\n  stop() {\n    // await watcher.close()\n\n  }\n\n  /**\n   * Create a tally of changes as they occur, and once things settle down, evaluate them. We do this because on directory changes in particular, chokidar lists each file modified, _and_ the directory modified. We don't want to trigger a bunch of file change handlers in this scenario, so we need to batch changes, so we can figure out they include directories.\n   */\n  batchChanges(event, filePath, stats) {\n    const change = { event: event, path: filePath }\n\n    if (stats) change.stats = stats\n    // console.log(event)\n\n    // Make the timer longer if `addDir` event comes through. \n    // If it's too quick, subsequent `add` events are not caught by the timer.\n    const timerDuration = event == 'addDir' ? 500 : 100\n\n    // Start a new timer if one is not already active.\n    // Or refresh a timer already in progress.\n    if (this.changeTimer == undefined || !this.changeTimer.hasRef()) {\n      this.changes = [change]\n      this.changeTimer = setTimeout(() => this.applyChanges(this.changes), timerDuration);\n    } else {\n      this.changes.push(change)\n      this.changeTimer.refresh()\n    }\n  }\n\n  /**\n   * Take batched changes and update `files`, then send patches to associated BrowserWindow.\n   * @param {*} changes \n   */\n  async applyChanges(changes) {\n\n    const directoryWasAddedOrRemoved = changes.some((c) => c.event == 'addDir' || c.event == 'unlinkDir')\n\n    if (directoryWasAddedOrRemoved) {\n      this.files = await mapProject(this.directory)\n    } else {\n      this.files = await produce(this.files, async (draft) => {\n        for (const c of changes) {\n          const ext = path.extname(c.path)\n          const parentPath = path.dirname(c.path)\n          const parentFolder = getFileByPath(draft, parentPath)\n          const parentTreeItem = findInTree(draft.tree, parentFolder.id, 'id')\n\n          if (isDoc(ext) || isMedia(ext)) {\n\n            switch (c.event) {\n              case 'add': {\n                const file = isDoc(ext) ?\n                  await mapDocument(c.path, parentFolder.id, parentFolder.nestDepth + 1, c.stats) :\n                  await mapMedia(c.path, parentFolder.id, parentFolder.nestDepth + 1, c.stats)\n                // Add to `byId`, `allIds`, and parent's children.\n                draft.byId[file.id] = file\n                draft.allIds.push(file.id)\n                parentTreeItem.children.push({\n                  id: file.id,\n                  parentId: file.parentId,\n                  type: file.type\n                })\n                break\n              }\n              case 'change': {\n                const file = isDoc(ext) ?\n                  await mapDocument(c.path, parentFolder.id, parentFolder.nestDepth + 1, c.stats) :\n                  await mapMedia(c.path, parentFolder.id, parentFolder.nestDepth + 1, c.stats)\n                draft.byId[file.id] = file\n                break\n              }\n              case 'unlink': {\n                const file = getFileByPath(draft, c.path)\n                // Remove from `byId`, `allIds`, and parent's children.\n                delete draft.byId[file.id]\n                draft.allIds.splice(file.index, 1)\n                const indexInChildren = parentTreeItem.children.findIndex((child) => child.id == file.id)\n                parentTreeItem.children.splice(indexInChildren, 1)\n                break\n              }\n            }\n          }\n        }\n      }, (patches, inversePatches) => {\n        const win = BrowserWindow.fromId(this.id)\n        console.log(patches)\n        win.webContents.send('filesPatchesFromMain', patches)\n      })\n    }\n  }\n}\n\n/**\n * Utility function for getting objects (folders, docs, or media), from `files` by path.\n * @param {*} lookIn - `files.folders`, `files.docs`, or `files.media`\n * @param {*} path \n */\nfunction getFileByPath(lookIn, path) {\n  let file = {}\n  lookIn.allIds.find((id, index) => {\n    if (lookIn.byId[id].path == path) {\n      file = {\n        id: id,\n        nestDepth: lookIn.byId[id].nestDepth,\n        index: index,\n      }\n      return true\n    }\n  })\n  return file\n}\n\n/**\n * Chokidar docs: https://www.npmjs.com/package/chokidar\n */\nconst chokidarConfig = {\n  ignored: /(^|[\\/\\\\])\\../, // Ignore dotfiles\n  ignoreInitial: true,\n  persistent: true,\n  awaitWriteFinish: {\n    stabilityThreshold: 400,\n    pollInterval: 200\n  }\n}\n","import { BrowserWindow } from 'electron'\nimport { propHasChanged } from '../shared/utils'\nimport { Watcher } from './watcher/Watcher'\n\n\n// -------- DISK MANAGER -------- //\n\n\nexport class DiskManager {\n\tconstructor() {\n\n\t\t// Listen for state changes\n\t\t/*\n\t\t\t- Is it cold start?\n\t\t\t\t- If yes, try to \n\t\t\t- Has a directory changed?\n\t\t\t\t- If yes, for that project, does a Watcher already exist?\n\t\t\t\t\t- If yes, update the Watcher.\n\t\t\t\t\t\t- TODO\n\t\t\t\t- If no, is the new directory path valid?\n\t\t\t\t\t- If yes, create Watcher and pass in project\n\t\t\t\t\t- If no, do nothing\n\t\t*/\n\t\tglobal.store.onDidAnyChange((state, oldState) => {\n\n\t\t\t// const isColdStart = hasChangedTo('appStatus', 'coldStarting', state, oldState)\n\t\t\t// const isColdStart = propHasChanged('appStatus', 'coldStarting')\n\t\t\tconst projectDirectoryChanged = propHasChanged(['projects', 'directory'])\n\t\t\tconst projectAdded = state.projects.length > oldState.projects.length\n\t\t\tconst projectRemoved = state.projects.length < oldState.projects.length\n\n\t\t\t// if (isColdStart) {\n\n\t\t\t// \t// For each project with a valid directory, create a watcher\n\t\t\t// \tstate.projects.forEach((project) => {\n\t\t\t// \t\tif (project.directory) {\n\t\t\t// \t\t\t// Create Watcher and add to `watchers` array\n\t\t\t// \t\t\tconst watcher = new Watcher(project)\n\t\t\t// \t\t\tthis.watchers.push(watcher)\n\t\t\t// \t\t}\n\t\t\t// \t})\n\t\t\t// } else \n\t\t\t// if (projectDirectoryChanged) {\n\n\t\t\t// \t// Create array of projects whose directories have changed\n\t\t\t// \t// First filter patches to those with directory changes\n\t\t\t// \t// Then get the associated projects from `state.projects`\n\t\t\t// \tconst projectsWithNewDirectories = global.patches.filter((patch) => {\n\t\t\t// \t\tconst pathAsString = patch.path.toString()\n\t\t\t// \t\tconst dirHasChanged =\n\t\t\t// \t\t\tpathAsString.includes('projects') &&\n\t\t\t// \t\t\tpathAsString.includes('directory')\n\t\t\t// \t\treturn dirHasChanged\n\t\t\t// \t}).map((patch) => {\n\t\t\t// \t\t// Format of patch path will be:\n\t\t\t// \t\t// `path: [ 'projects', 0, 'directory' ],`\n\t\t\t// \t\t// The project index is the integer (always second value).\n\t\t\t// \t\tconst projectIndex = patch.path[1] //\n\t\t\t// \t\tconst project = state.projects[projectIndex]\n\t\t\t// \t\treturn project\n\t\t\t// \t})\n\n\t\t\t// \tprojectsWithNewDirectories.forEach((project) => {\n\t\t\t// \t\t// Does corresponding watcher exist?\n\t\t\t// \t\tconst watcher = global.watchers.find(({ id }) => id == project.id)\n\n\t\t\t// \t\t// If yes, update it. Else, create one.\n\t\t\t// \t\tif (watcher) {\n\t\t\t// \t\t\tconsole.log(\"TODO: Update watcher!!\")\n\t\t\t// \t\t} else {\n\t\t\t// \t\t\tconst watcher = new Watcher(project)\n\t\t\t// \t\t\tthis.watchers.push(watcher)\n\t\t\t// \t\t}\n\t\t\t// \t})\n\n\t\t\t// } else if (projectAdded) {\n\t\t\t// \t// Get new project. Then create Watcher and add to `watchers` array\n\t\t\t// \tconst project = state.projects[state.projects.length - 1]\n\t\t\t// \tconst watcher = new Watcher(project)\n\t\t\t// \tthis.watchers.push(watcher)\n\t\t\t// } else if (projectRemoved) {\n\t\t\t// \t// Remove the matching watcher. Do so by comparing projects and watchers. Find the watcher who does not have a corresponding project, by comparing IDs, then remove it.\n\t\t\t// }\n\t\t})\n\t}\n\n\t// Array of Watcher instances.\n\twatchers = []\n\n\t/**\n\t * On startup, create a Watcher instance for each project with a valid `directory`. If a project does not have a valid directory, do nothing. We'll catch the change and set one up later (see listeners in Constructor).\n\t */\n\tasync startup() {\n\t\tlet index = 0\n\t\tfor (const project of global.state().projects) {\n\n\t\t\t// Create Watcher and add to `watchers` array\n\t\t\tconst watcher = new Watcher(project)\n\t\t\tthis.watchers.push(watcher)\n\t\t}\n\t}\n}\n","import { remove } from 'fs-extra'\n\nexport default async function(path) {\n  try {\n\t\tawait remove(path)\n\t\treturn { type: 'DELETE_FILE_SUCCESS', path: path }\n\t} catch(err) {\n\t\treturn { type: 'DELETE_FILE_FAIL', err: err }\n\t}\n}","import { remove } from 'fs-extra'\n\nexport default async function(paths) {\n  try {\n    let deletedPaths = await Promise.all(\n      paths.map(async (path) => {\n        await remove(path)\n      })\n    )\n\t\treturn { type: 'DELETE_FILES_SUCCESS', paths: deletedPaths }\n\t} catch(err) {\n\t\treturn { type: 'DELETE_FILES_FAIL', err: err }\n\t}\n}","import { writeFile } from 'fs-extra'\n\nexport default async function (path, data) {\n\ttry {\n\t\tawait writeFile(path, data, 'utf8')\n\t\treturn {\n\t\t\ttype: 'SAVE_FILE_SUCCESS',\n\t\t\tpath: path,\n\t\t}\n\t} catch (err) {\n\t\treturn {\n\t\t\ttype: 'SAVE_FILE_FAIL',\n\t\t\terr: err\n\t\t}\n\t}\n}","import { BrowserWindow, dialog } from 'electron'\n\nexport default async function () {\n\n  const win = BrowserWindow.getFocusedWindow()\n\n  const selection = await dialog.showOpenDialog(win, {\n    title: 'Select Project Folder',\n    properties: ['openDirectory', 'createDirectory']\n  })\n\n  if (!selection.canceled) {\n    return { type: 'SET_PROJECT_DIRECTORY', directory: selection.filePaths[0] }\n  }\n}","import { app, BrowserWindow, clipboard, dialog, ipcMain, shell, systemPreferences, nativeTheme, webFrame } from 'electron'\n\nimport { saveFile, deleteFile, deleteFiles, setProjectPath } from './actions/index.js'\n\nexport class IpcManager {\n  constructor() {\n\n    // -------- IPC: Renderer \"receives\" from Main -------- //\n\n    // On change, send updated state to renderer (each BrowserWindow)\n    // global.store.onDidAnyChange(async (state, oldState) => {\n    //   const windows = BrowserWindow.getAllWindows()\n    //   if (windows.length) {\n    //     windows.forEach((win) => win.webContents.send(' ', state, oldState))\n    //   }\n    // })\n\n    // -------- IPC: Renderer \"sends\" to Main -------- //\n\n    ipcMain.on('showWindow', (evt) => {\n      const win = BrowserWindow.fromWebContents(evt.sender)\n      win.show()\n    })\n\n    ipcMain.on('safelyCloseWindow', async (evt) => {\n      const win = BrowserWindow.fromWebContents(evt.sender)\n      if (!global.state().areQuiting) {\n        await global.store.dispatch({\n          type: 'REMOVE_PROJECT'\n        }, win.id)\n      }\n      win.destroy()\n    })\n\n    ipcMain.on('dispatch', async (evt, action) => {\n      const win = BrowserWindow.fromWebContents(evt.sender)\n      switch (action.type) {\n        case ('SELECT_PROJECT_DIRECTORY'):\n          store.dispatch(await setProjectPath(), win.id)\n          break\n        case ('SAVE_FILE'):\n          store.dispatch(await saveFile(action.path, action.data), win.id)\n          break\n        case ('DELETE_FILE'):\n          store.dispatch(await deleteFile(action.path), win.id)\n          break\n        case ('DELETE_FILES'):\n          store.dispatch(await deleteFiles(action.paths), win.id)\n          break\n        default:\n          store.dispatch(action, win.id)\n          break\n      }\n    })\n\n    // -------- IPC: Invoke -------- //\n\n    ipcMain.handle('getState', (evt) => {\n      return global.state()\n    })\n\n    ipcMain.handle('getFiles', (evt) => {\n      const win = BrowserWindow.fromWebContents(evt.sender)\n      const watcher = global.watchers.find((watcher) => watcher.id == win.id)\n      return watcher.files\n    })\n  }\n}\n\n\n\n// -------- IPC: Renderer \"sends\" to Main -------- //\n\n\n// // ipcMain.on('saveProjectStateToDisk', (evt, state) => {\n// //   const win = BrowserWindow.fromWebContents(evt.sender)\n// //   const projects = store.store.projects.slice(0)\n// //   const indexOfProjectToUpdate = projects.findIndex((p) => p.windowId == state.windowId)\n// //   projects[indexOfProjectToUpdate] = state\n// //   store.set('projects', projects)\n// // })\n\n// // ipcMain.on('saveFileThenCloseWindow', async (event, path, data) => {\n// //   await writeFile(path, data, 'utf8')\n// //   canCloseWindowSafely = true\n// //   win.close()\n// // })\n\n// // ipcMain.on('saveFileThenQuitApp', async (event, path, data) => {\n// //   await writeFile(path, data, 'utf8')\n// //   canQuitAppSafely = true\n// //   app.quit()\n// // })\n\n// // ipcMain.on('openUrlInDefaultBrowser', (event, url) => {\n// //   shell.openExternal(url)\n// // })\n\n\n\n// // // -------- IPC: Invoke -------- //\n\n// // ipcMain.handle('getSystemColors', () => {\n\n// //   // Get accent color, chop off last two characters (always `ff`, for 100% alpha), and prepend `#`.\n// //   // `0a5fffff` --> `#0a5fff`\n// //   let controlAccentColor = `#${systemPreferences.getAccentColor().slice(0, -2)}`\n\n// //   const systemColors = [\n\n// //     // -------------- System Colors -------------- //\n// //     // Note: Indigo and Teal exist in NSColor, but do not seem to be supported by Electron.\n\n// //     { name: 'systemBlue', color: systemPreferences.getSystemColor('blue') },\n// //     { name: 'systemBrown', color: systemPreferences.getSystemColor('brown') },\n// //     { name: 'systemGray', color: systemPreferences.getSystemColor('gray') },\n// //     { name: 'systemGreen', color: systemPreferences.getSystemColor('green') },\n// //     // { name: 'systemIndigo', color: systemPreferences.getSystemColor('systemIndigo')},\n// //     { name: 'systemOrange', color: systemPreferences.getSystemColor('orange') },\n// //     { name: 'systemPink', color: systemPreferences.getSystemColor('pink') },\n// //     { name: 'systemPurple', color: systemPreferences.getSystemColor('purple') },\n// //     { name: 'systemRed', color: systemPreferences.getSystemColor('red') },\n// //     // { name: 'systemTeal', color: systemPreferences.getSystemColor('teal')},\n// //     { name: 'systemYellow', color: systemPreferences.getSystemColor('yellow') },\n\n// //     // -------------- Label Colors -------------- //\n\n// //     { name: 'labelColor', color: systemPreferences.getColor('label') },\n// //     { name: 'secondaryLabelColor', color: systemPreferences.getColor('secondary-label') },\n// //     { name: 'tertiaryLabelColor', color: systemPreferences.getColor('tertiary-label') },\n// //     { name: 'quaternaryLabelColor', color: systemPreferences.getColor('quaternary-label') },\n\n// //     // -------------- Text Colors -------------- //\n\n// //     { name: 'textColor', color: systemPreferences.getColor('text') },\n// //     { name: 'placeholderTextColor', color: systemPreferences.getColor('placeholder-text') },\n// //     { name: 'selectedTextColor', color: systemPreferences.getColor('selected-text') },\n// //     { name: 'textBackgroundColor', color: systemPreferences.getColor('text-background') },\n// //     { name: 'selectedTextBackgroundColor', color: systemPreferences.getColor('selected-text-background') },\n// //     { name: 'keyboardFocusIndicatorColor', color: systemPreferences.getColor('keyboard-focus-indicator') },\n// //     { name: 'unemphasizedSelectedTextColor', color: systemPreferences.getColor('unemphasized-selected-text') },\n// //     { name: 'unemphasizedSelectedTextBackgroundColor', color: systemPreferences.getColor('unemphasized-selected-text-background') },\n\n// //     // -------------- Content Colors -------------- //\n\n// //     { name: 'linkColor', color: systemPreferences.getColor('link') },\n// //     { name: 'separatorColor', color: systemPreferences.getColor('separator') },\n// //     { name: 'selectedContentBackgroundColor', color: systemPreferences.getColor('selected-content-background') },\n// //     { name: 'unemphasizedSelectedContentBackgroundColor', color: systemPreferences.getColor('unemphasized-selected-content-background') },\n\n// //     // -------------- Menu Colors -------------- //\n\n// //     { name: 'selectedMenuItemTextColor', color: systemPreferences.getColor('selected-menu-item-text') },\n\n// //     // -------------- Table Colors -------------- //\n\n// //     { name: 'gridColor', color: systemPreferences.getColor('grid') },\n// //     { name: 'headerTextColor', color: systemPreferences.getColor('header-text') },\n\n// //     // -------------- Control Colors -------------- //\n\n// //     { name: 'controlAccentColor', color: controlAccentColor },\n// //     { name: 'controlColor', color: systemPreferences.getColor('control') },\n// //     { name: 'controlBackgroundColor', color: systemPreferences.getColor('control-background') },\n// //     { name: 'controlTextColor', color: systemPreferences.getColor('control-text') },\n// //     { name: 'disabledControlTextColor', color: systemPreferences.getColor('disabled-control-text') },\n// //     { name: 'selectedControlColor', color: systemPreferences.getColor('selected-control') },\n// //     { name: 'selectedControlTextColor', color: systemPreferences.getColor('selected-control-text') },\n// //     { name: 'alternateSelectedControlTextColor', color: systemPreferences.getColor('alternate-selected-control-text') },\n\n// //     // -------------- Window Colors -------------- //\n\n// //     { name: 'windowBackgroundColor', color: systemPreferences.getColor('window-background') },\n// //     { name: 'windowFrameTextColor', color: systemPreferences.getColor('window-frame-text') },\n\n// //     // -------------- Highlight & Shadow Colors -------------- //\n\n// //     { name: 'findHighlightColor', color: systemPreferences.getColor('find-highlight') },\n// //     { name: 'highlightColor', color: systemPreferences.getColor('highlight') },\n// //     { name: 'shadowColor', color: systemPreferences.getColor('shadow') },\n// //   ]\n\n// //   return systemColors\n// // })\n\n\n// // ipcMain.handle('getValidatedPathOrURL', async (event, docPath, pathToCheck) => {\n// //   // return path.resolve(basePath, filepath)\n\n// //   /*\n// //   Element: Image, link, backlink, link reference definition\n// //   File type: directory, html, png|jpg|gif, md|mmd|markdown\n// //   */\n\n// //   // console.log('- - - - - -')\n// //   // console.log(pathToCheck.match(/.{0,2}\\//))\n// //   const directory = path.parse(docPath).dir\n// //   const resolvedPath = path.resolve(directory, pathToCheck)\n\n// //   const docPathExists = await pathExists(docPath)\n// //   const pathToCheckExists = await pathExists(pathToCheck)\n// //   const resolvedPathExists = await pathExists(resolvedPath)\n\n// //   // console.log('docPath: ', docPath)\n// //   // console.log('pathToCheck: ', pathToCheck)\n// //   // console.log('resolvedPath: ', resolvedPath)\n// //   // console.log(docPathExists, pathToCheckExists, resolvedPathExists)\n\n// //   // if (pathToCheck.match(/.{0,2}\\//)) {\n// //   //   console.log()\n// //   // }\n// // })\n\n// // ipcMain.handle('getResolvedPath', async (event, basePath, filepath) => {\n// //   return path.resolve(basePath, filepath)\n// // })\n\n// // ipcMain.handle('getParsedPath', async (event, filepath) => {\n// //   return path.parse(filepath)\n// // })\n\n// // ipcMain.handle('ifPathExists', async (event, filepath) => {\n// //   const exists = await pathExists(filepath)\n// //   return { path: filepath, exists: exists }\n// // })\n\n\n\n// // ipcMain.handle('getState', async (event) => {\n// //   return store.store\n// // })\n\n// // ipcMain.handle('getCitations', (event) => {\n// //   return projectCitations.getCitations()\n// // })\n\n// // ipcMain.handle('getFileByPath', async (event, filePath, encoding) => {\n\n// //   // Load file and return\n// //   let file = await readFile(filePath, encoding)\n// //   return file\n// // })\n\n// // ipcMain.handle('getFileById', async (event, id, encoding) => {\n\n// //   // Get path of file with matching id\n// //   const filePath = store.store.contents.find((f) => f.id == id).path\n\n// //   // Load file and return\n// //   let file = await readFile(filePath, encoding)\n// //   return file\n// // })\n\n// // ipcMain.handle('pathJoin', async (event, path1, path2) => {\n// //   return path.join(path1, path2)\n// // })\n\n// // ipcMain.handle('getHTMLFromClipboard', (event) => {\n// //   return clipboard.readHTML()\n// // })\n\n// // ipcMain.handle('getFormatOfClipboard', (event) => {\n// //   return clipboard.availableFormats()\n// // })","import { app, Menu, MenuItem, nativeTheme } from 'electron'\n\nexport class MenuBarManager {\n  constructor() {\n\n    this.isMac = process.platform === 'darwin'\n    this.menuItems = {}\n\n    // Listen for state changes\n    global.store.onDidAnyChange((state, oldState) => {\n      // if (state.changed.includes('')) {\n\n      // }\n    })\n\n    // Set initial menu bar\n    this.setMenuBar()\n  }\n\n  setMenuBar() {\n    Menu.setApplicationMenu(this.getMenu())\n  }\n\n  update() {\n    // TODO\n  }\n\n  getMenu() {\n    const menu = new Menu()\n    this.menuItems = this.getMenuItems()\n    this.menuItems.topLevel.forEach((item) => menu.append(item))\n    return menu\n  }\n\n  getMenuItems() {\n    const items = { topLevel: [] } // reset\n    const _______________ = new MenuItem({ type: 'separator' })\n\n    // -------- App (Mac-only) -------- //\n\n    if (this.isMac) {\n      items.topLevel.push(new MenuItem({\n        label: app.name,\n        submenu: [\n          { role: 'about' },\n          { type: 'separator' },\n          { role: 'services', submenu: [] },\n          { type: 'separator' },\n          { role: 'hide' },\n          { role: 'hideothers' },\n          { role: 'unhide' },\n          { type: 'separator' },\n          { role: 'quit' }\n        ]\n      }))\n    }\n\n    // -------- File (Mac-only) -------- //\n\n    if (this.isMac) {\n\n      items.newDocument = new MenuItem({\n        label: 'New Document',\n        accelerator: 'CmdOrCtrl+N',\n        async click(item, focusedWindow) {\n          // global.store.dispatch(await newFile(state))\n        }\n      })\n\n      items.newWindow = new MenuItem({\n        label: 'New Window',\n        accelerator: 'CmdOrCtrl+Shift+N',\n        async click(item, focusedWindow) {\n          global.store.dispatch({ type: 'CREATE_NEW_PROJECT' })\n        }\n      })\n\n      items.save = new MenuItem({\n        label: 'Save',\n        accelerator: 'CmdOrCtrl+S',\n        click(item, focusedWindow) {\n          // focusedWindow.webContents.send('mainRequestsSaveFile')\n        }\n      })\n\n      items.moveToTrash = new MenuItem({\n        label: 'Move to Trash',\n        accelerator: 'CmdOrCtrl+Backspace',\n        enabled: state.focusedLayoutSection == 'navigation',\n        click(item, focusedWindow) {  \n          // focusedWindow.webContents.send('mainRequestsDeleteFile')\n        }\n      })\n\n      items.topLevel.push(new MenuItem({\n        label: 'File',\n        submenu: [\n          items.newDocument,\n          items.newWindow,\n          _______________,\n          items.save,\n          items.moveToTrash\n        ]\n      }))\n    }\n\n    return items\n  }\n}","import { debounce } from 'debounce'\nimport { app, BrowserWindow, screen } from 'electron'\nimport path from 'path'\nimport url from 'url'\nimport { hasChangedTo } from '../shared/utils'\n\nexport class WindowManager {\n\n  constructor() {\n\n    // Listen for state changes\n    global.store.onDidAnyChange((state, oldState) => {\n      if (state.projects.length > oldState.projects.length) {\n        const newProjectIndex = state.projects.length - 1\n        const newProject = state.projects[newProjectIndex]\n        this.createWindow(newProjectIndex, newProject)\n      }\n      // const isStartingUp = hasChangedTo('appStatus', 'coldStarting', state, oldState)\n      // if (isStartingUp) {\n      //   state.projects.forEach(async (p, index) => {\n      //     this.createWindow(index, p.window.bounds)\n      //   })\n      // } else if (state.projects.length > oldState.projects.length) {\n      //   this.createWindow(state.projects.length - 1)\n      // }\n    })\n  }\n\n  /**\n   * On startup, create a BrowserWindow for each project.\n   */\n  async startup() {\n    let index = 0\n    for (const project of global.state().projects) {\n      await this.createWindow(index, project)\n      index++\n    }\n  }\n\n  async createWindow(projectIndex, project) {\n\n    const win = new BrowserWindow(browserWindowConfig)\n    const isFirstRun = project.directory == ''\n\n    // Set size. If project directory is empty, it's first run, and we set window centered, and filling most of the primary screen. Else we restore the previous window size and position (stored in `bounds` property)/\n    // Else, create a new window centered on screen.\n    if (isFirstRun) {\n      const menuBarHeight = 24\n      const { width, height } = screen.getPrimaryDisplay().workAreaSize\n      const padding = 80\n      win.setBounds({\n        x: padding,\n        y: padding,\n        width: width - padding * 2,\n        height: height - padding * 2\n      }, false)\n    } else {\n      win.setBounds(project.window.bounds, false)\n    }\n\n    // Load index.html\n    await win.loadFile(path.join(__dirname, 'index.html'), {\n      query: {\n        id: win.id\n      },\n    })\n\n    // Have to manually set this to 1.0. That should be the default, but I've had problem where something was setting it to 0.91, resulting in the UI being slightly too-small.\n    win.webContents.zoomFactor = 1.0\n\n    // Listen for close action. Is triggered by pressing close button on window, or close menu item, or app quit. Prevent default, and update state.\n    win.on('close', async (evt) => {\n      const state = global.state()\n      const project = state.projects.find((p) => p.window.id == win.id)\n\n      switch (project.window.status) {\n        case 'open':\n          evt.preventDefault()\n          await global.store.dispatch({ type: 'START_TO_CLOSE_WINDOW' }, win.id)\n          break\n        case 'safeToClose':\n          // Remove project from `state.projects` if window closing was NOT triggered by app quiting. When quiting, the user expects the project to still be there when the app is re-opened. \n          const shouldRemoveProject = state.appStatus !== 'wantsToQuit'\n          if (shouldRemoveProject) {\n            global.store.dispatch({ type: 'REMOVE_PROJECT' }, win.id)\n          }\n          break\n      }\n    })\n\n    // On resize or move, save bounds to state (wait 1 second to avoid unnecessary spamming)\n    // Using `debounce` package: https://www.npmjs.com/package/debounce\n    win.on('resize', debounce(() => { saveWindowBoundsToState(win) }, 1000))\n    win.on('move', debounce(() => { saveWindowBoundsToState(win) }, 1000))\n\n    // Listen for app quiting, and start to close window\n    global.store.onDidAnyChange(async (state, oldState) => {\n      const appWantsToQuit = hasChangedTo('appStatus', 'wantsToQuit', state, oldState)\n      if (appWantsToQuit) {\n        await global.store.dispatch({ type: 'START_TO_CLOSE_WINDOW' }, win.id)\n      } else {\n        const project = state.projects.find((p) => p.window.id == win.id)\n        const oldProject = oldState.projects.find((p) => p.window.id == win.id)\n        const isSafeToCloseThisWindow = hasChangedTo('window.status', 'safeToClose', project, oldProject)\n        if (isSafeToCloseThisWindow) {\n          win.close()\n        }\n      }\n    })\n\n    // Open DevTools\n    if (!app.isPackaged) win.webContents.openDevTools();\n\n    global.store.dispatch({\n      type: 'OPENED_WINDOW',\n      projectIndex: projectIndex,\n    }, win.id)\n\n    return win\n  }\n}\n\n/**\n * Save window bounds to state, so we can restore after restart.\n */\nfunction saveWindowBoundsToState(win) {\n  global.store.dispatch({ type: 'SAVE_WINDOW_BOUNDS', windowBounds: win.getBounds() }, win.id)\n}\n\n\nconst browserWindowConfig = {\n  show: false,\n  zoomFactor: 1.0,\n  vibrancy: 'sidebar',\n  transparent: true,\n  titleBarStyle: 'hiddenInset',\n  webPreferences: {\n    scrollBounce: false,\n    // Security:\n    allowRunningInsecureContent: false,\n    contextIsolation: true,\n    enableRemoteModule: false,\n    nativeWindowOpen: false,\n    nodeIntegration: false,\n    nodeIntegrationInWorker: false,\n    nodeIntegrationInSubFrames: false,\n    safeDialogs: true,\n    sandbox: true,\n    webSecurity: true,\n    webviewTag: false,\n    // Preload\n    preload: path.join(__dirname, 'js/preload.js')\n  }\n}","// External dependencies\nimport { app, BrowserWindow, clipboard, dialog, shell, systemPreferences, nativeTheme, webFrame } from 'electron'\nimport path from 'path'\nimport { writeFile, readFile, pathExists } from 'fs-extra'\n\n// Bundled dependencies\nimport { Store } from './Store'\nimport { AppearanceManager } from './AppearanceManager'\nimport { DiskManager } from './DiskManager'\nimport { IpcManager } from './IpcManager'\nimport { MenuBarManager } from './MenuBarManager'\nimport { WindowManager } from './WindowManager'\nimport { hasChanged, hasChangedTo } from '../shared/utils.js'\n\n\n// -------- Process variables -------- //\n\nprocess.env.ELECTRON_DISABLE_SECURITY_WARNINGS = true\n\n\n// -------- Reload (Development-only) -------- //\n\nif (!app.isPackaged) {\n\n  const watchAndReload = [\n    path.join(__dirname, '**/*.js'),\n    path.join(__dirname, '**/*.html'),\n    path.join(__dirname, '**/*.css'),\n    path.join(__dirname, '**/*.xml')\n    // 'main.js',\n    // '**/*.js',\n    // '**/*.html',\n    // '**/*.css',\n    // '**/*.xml',\n    // '**/*.png',\n    // '**/*.jpg',\n  ]\n\n  require('electron-reload')(watchAndReload, {\n    // awaitWriteFinish: {\n    //   stabilityThreshold: 10,\n    //   pollInterval: 50\n    // },\n    electron: path.join(__dirname, '../node_modules', '.bin', 'electron'),\n    hardResetMethod: 'exit'\n    // argv: ['--inspect=5858'],\n  })\n\n  console.log('// - - - - - - - - - - - - - - -')\n  console.log(`Gambier. Electron ${process.versions.electron}. Chrome ${process.versions['chrome']}`)\n}\n\n\n// -------- SETUP -------- //\n\n// Create store (and global variables for store and state)\nglobal.store = new Store()\nglobal.state = () => global.store.store\nglobal.patches = [] // Most recent patches from Immer\n\n// Create managers\nconst appearanceManager = new AppearanceManager()\nconst diskManager = new DiskManager()\nconst ipcManager = new IpcManager()\nconst menuBarManager = new MenuBarManager()\nconst windowManager = new WindowManager()\n\n// One more global variable\nglobal.watchers = diskManager.watchers\n\n// Set this to shut up console warnings re: deprecated default. If not set, it defaults to `false`, and console then warns us it will default `true` as of Electron 9. Per: https://github.com/electron/electron/issues/18397\napp.allowRendererProcessReuse = true\n\n// Start app\napp.whenReady()\n  .then(async () => {\n    // TODO\n    // appearanceManager.setNativeTheme\n\n    // Kickoff app cold start. Reducers prep state as necessary.\n    // E.g. Prune projects with inaccessible directoris.\n    await global.store.dispatch({ type: 'START_COLD_START' })\n    // Create a window for each project\n    await windowManager.startup()\n    // Create a Watcher instance for each project\n    await diskManager.startup()\n    // App startup complete!\n    await global.store.dispatch({ type: 'FINISH_COLD_START' })\n  })\n\n\n// -------- LISTENERS -------- //\n\n// Quit app: Start by setting appStatus to 'safeToQuit', if it is not yet so. This triggers windows to close. Once all of them have closed, update appStatus to 'safeToQuit', and then trigger `app.quit` again. This time it will go through.\n\napp.on('before-quit', async (evt) => {\n  if (global.state().appStatus !== 'safeToQuit') {\n    evt.preventDefault()\n    await global.store.dispatch({\n      type: 'START_TO_QUIT'\n    })\n  }\n})\n\nglobal.store.onDidAnyChange(async (state) => {\n  if (state.appStatus == 'wantsToQuit') {\n    const isAllWindowsSafelyClosed = state.projects.every((p) => p.window.status == 'safeToClose')\n    if (isAllWindowsSafelyClosed) {\n      await global.store.dispatch({ type: 'CAN_SAFELY_QUIT' })\n      app.quit()\n    }\n  }\n})\n\n// All windows closed\napp.on('window-all-closed', () => {\n  // \"On macOS it is common for applications and their menu bar to stay active until the user quits explicitly with Cmd + Q\"  https://www.geeksforgeeks.org/save-files-in-electronjs/\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n"],"names":["enablePatches","produce","BrowserWindow","accessSync","fs","ElectronStore","app","stat","matter","path","removeMd","sizeOf","readdir","chokidar","remove","writeFile","dialog","ipcMain","Menu","MenuItem","screen","debounce"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMAA,qBAAa,GAAE;AACf;AACO,MAAM,MAAM,GAAG,CAAC,KAAK,EAAE,MAAM,EAAE,QAAQ;AAC9C,EAAEC,2BAAO,CAAC,KAAK,EAAE,CAAC,KAAK,KAAK;AAC5B;AACA;AACA,IAAI,MAAM,GAAG,GAAG,QAAQ,KAAK,SAAS,GAAGC,sBAAa,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,UAAS;AACnF,IAAI,MAAM,OAAO,GAAG,QAAQ,KAAK,SAAS,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,EAAE,IAAI,QAAQ,CAAC,GAAG,UAAS;AAC5G;AACA,IAAI,QAAQ,MAAM,CAAC,IAAI;AACvB;AACA;AACA;AACA,MAAM,KAAK,kBAAkB,EAAE;AAC/B;AACA;AACA,QAAQ,KAAK,CAAC,SAAS,GAAG,eAAc;AACxC;AACA;AACA,QAAQ,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE;AACnC,UAAU,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,OAAO,KAAK;AAC9D,YAAY,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,KAAK;AAChD,YAAY,IAAI;AAChB,cAAcC,kBAAU,CAAC,OAAO,CAAC,SAAS,EAAEC,sBAAE,CAAC,SAAS,CAAC,IAAI,EAAC;AAC9D,cAAc,OAAO,IAAI;AACzB,aAAa,CAAC,MAAM,GAAG,EAAE;AACzB,cAAc,OAAO,KAAK;AAC1B,aAAa;AACb,WAAW,EAAC;AACZ,SAAS;AACT;AACA;AACA,QAAQ,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE;AACpC,UAAU,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,gBAAgB,EAAE,EAAC;AACjD,SAAS;AACT;AACA,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,mBAAmB,EAAE;AAChC,QAAQ,KAAK,CAAC,SAAS,GAAG,OAAM;AAChC,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,eAAe,EAAE;AAC5B,QAAQ,KAAK,CAAC,SAAS,GAAG,cAAa;AACvC,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,iBAAiB,EAAE;AAC9B,QAAQ,KAAK,CAAC,SAAS,GAAG,aAAY;AACtC,QAAQ,KAAK;AACb,OAAO;AACP;AACA;AACA;AACA;AACA,MAAM,KAAK,oBAAoB,EAAE;AACjC,QAAQ,gBAAgB,CAAM,EAAC;AAC/B,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,uBAAuB,EAAE;AACpC;AACA,QAAQ,OAAO,CAAC,SAAS,GAAG,MAAM,CAAC,UAAS;AAC5C,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,eAAe,EAAE;AAC5B;AACA,QAAQ,MAAM,OAAO,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,EAAC;AAC3D,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,OAAM;AACtC,QAAQ,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,SAAQ;AACpC,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,uBAAuB,EAAE;AACpC,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,eAAc;AAC9C,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,yBAAyB,EAAE;AACtC,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,cAAa;AAC7C,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,gBAAgB,EAAE;AAC7B,QAAQ,MAAM,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAC;AAChD,QAAQ,MAAM,sBAAsB,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,EAAE,IAAI,QAAQ,EAAC;AACzF,QAAQ,QAAQ,CAAC,MAAM,CAAC,sBAAsB,EAAE,CAAC,EAAC;AAClD,QAAQ,KAAK,CAAC,QAAQ,GAAG,EAAE,GAAG,QAAQ,GAAE;AACxC,QAAQ,KAAK;AACb,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK,yBAAyB,EAAE;AACtC,QAAQ,IAAI;AACZ;AACA;AACA,UAAUD,kBAAU,CAAC,MAAM,CAAC,IAAI,EAAEC,sBAAE,CAAC,SAAS,CAAC,IAAI,EAAC;AACpD;AACA,UAAU,OAAO,CAAC,SAAS,GAAG,MAAM,CAAC,KAAI;AACzC,SAAS,CAAC,OAAO,GAAG,EAAE;AACtB;AACA,SAAS;AACT,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,sBAAsB,EAAE;AACnC;AACA,QAAQ,KAAK;AACb,OAAO;AACP;AACA;AACA;AACA,MAAM,KAAK,kBAAkB,EAAE;AAC/B,QAAQ,OAAO,CAAC,oBAAoB,GAAG,MAAM,CAAC,QAAO;AACrD,QAAQ,KAAK;AACb,OAAO;AACP;AACA;AACA;AACA;AACA,MAAM,KAAK,oBAAoB,EAAE;AACjC,QAAQ,OAAO,CAAC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC,aAAY;AACnD,QAAQ,KAAK;AACb,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,MAAM,KAAK,0BAA0B,EAAE;AACvC,QAAQ,OAAO,CAAC,OAAO,CAAC,WAAW,GAAG,MAAM,CAAC,GAAE;AAC/C,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,sBAAsB,EAAE;AACnC,QAAQ,MAAM,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAC;AAC1D,QAAQ,GAAG,CAAC,QAAQ,GAAG,MAAM,CAAC,SAAQ;AACtC,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,sBAAsB,EAAE;AACnC,QAAQ,MAAM,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAC;AAC1D,QAAQ,GAAG,CAAC,YAAY,GAAG,MAAM,CAAC,aAAY;AAC9C,QAAQ,GAAG,CAAC,QAAQ,GAAG,MAAM,CAAC,SAAQ;AACtC,QAAQ,KAAK;AACb,OAAO;AACP;AACA,MAAM,KAAK,6BAA6B,EAAE;AAC1C,QAAQ,OAAO,CAAC,OAAO,CAAC,WAAW,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,EAAC;AAC3E,QAAQ,KAAK;AACb,OAAO;AACP,MAAM,KAAK,wBAAwB,EAAE;AACrC,QAAQ,OAAO,CAAC,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,cAAa;AACtE,QAAQ,KAAK;AACb,OAAO;AACP;AACA,KAAK;AACL,GAAG,EAAE,CAAC,OAAO,KAAK;AAClB;AACA,IAAI,MAAM,CAAC,OAAO,GAAG,QAAO;AAC5B,GAAG,EAAC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,eAAe,GAAG;AAC3B,EAAE,MAAM,iBAAiB,GAAGF,sBAAa,CAAC,aAAa,EAAE;AACzD,KAAK,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,EAAE,EAAC;AACzB,EAAE,MAAM,YAAY,GAAG,IAAI,CAAC,GAAG,CAAC,iBAAiB,CAAC,GAAG,EAAC;AACtD,EAAE,OAAO,YAAY;AACrB,CAAC;AACD;AACA;AACA;AACA;AACA,SAAS,gBAAgB,GAAG;AAC5B,EAAE,MAAM,OAAO,GAAG,EAAE,GAAG,UAAU,GAAE;AACnC,EAAE,OAAO,CAAC,MAAM,CAAC,EAAE,GAAG,eAAe,GAAE;AACvC,EAAE,OAAO,OAAO;AAChB;;AC5LO,MAAM,KAAK,SAASG,iCAAa,CAAC;AACzC,EAAE,WAAW,GAAG;AAChB;AACA;AACA;AACA,IAAI,KAAK,CAAC;AACV,MAAM,IAAI,EAAE,OAAO;AACnB,MAAM,QAAQ,EAAE,YAAY;AAC5B;AACA,KAAK,EAAC;AACN,GAAG;AACH;AACA,EAAE,MAAM,QAAQ,CAAC,MAAM,EAAE,QAAQ,GAAG,SAAS,EAAE;AAC/C;AACA,IAAI,IAAI,CAACC,YAAG,CAAC,UAAU,EAAE,YAAY,CAAC,MAAM,EAAC;AAC7C;AACA;AACA;AACA,IAAI,MAAM,SAAS,GAAG,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAC;AAC3D;AACA;AACA,IAAI,IAAI,CAAC,GAAG,CAAC,SAAS,EAAC;AACvB;AACA;AACA,IAAI,MAAM,OAAO,GAAGJ,sBAAa,CAAC,aAAa,GAAE;AACjD,IAAI,IAAI,OAAO,CAAC,MAAM,EAAE;AACxB,MAAM,OAAO,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,sBAAsB,EAAE,MAAM,CAAC,OAAO,CAAC,EAAC;AAC5F,KAAK;AACL,GAAG;AACH,CAAC;AACD;AACA,SAAS,YAAY,CAAC,MAAM,EAAE;AAC9B,EAAE,OAAO,CAAC,GAAG;AACb;AACA,IAAI,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI;AAC7C;AACA,IAAG;AACH,CAAC;AACD;AACA,MAAM,YAAY,GAAG;AACrB;AACA;AACA;AACA,EAAE,SAAS,EAAE,MAAM;AACnB;AACA;AACA,EAAE,UAAU,EAAE;AACd,IAAI,QAAQ,EAAE,cAAc;AAC5B,IAAI,KAAK,EAAE,eAAe;AAC1B,GAAG;AACH;AACA,EAAE,MAAM,EAAE;AACV,IAAI,cAAc,EAAE,GAAG;AACvB,GAAG;AACH;AACA;AACA;AACA,EAAE,QAAQ,EAAE,EAAE;AACd;AACA,EAAC;AACD;AACO,MAAM,UAAU,GAAG;AAC1B;AACA,EAAE,MAAM,EAAE;AACV;AACA,IAAI,EAAE,EAAE,CAAC;AACT;AACA,IAAI,MAAM,EAAE,MAAM;AAClB,IAAI,MAAM,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE;AACrD,GAAG;AACH;AACA;AACA,EAAE,SAAS,EAAE,EAAE;AACf;AACA;AACA,EAAE,SAAS,EAAE,EAAE;AACf;AACA,EAAE,oBAAoB,EAAE,SAAS;AACjC;AACA;AACA,EAAE,OAAO,EAAE,EAAE;AACb;AACA;AACA,EAAE,OAAO,EAAE;AACX,IAAI,MAAM,EAAE,IAAI;AAChB,IAAI,aAAa,EAAE,IAAI;AACvB,IAAI,WAAW,EAAE,SAAS;AAC1B,IAAI,KAAK,EAAE,GAAG;AACd,IAAI,QAAQ,EAAE;AACd,MAAM,OAAO,EAAE;AACf,QAAQ,KAAK,EAAE,SAAS;AACxB,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,KAAK,EAAE,eAAe;AAC9B,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,MAAM,UAAU,EAAE;AAClB,QAAQ,KAAK,EAAE,aAAa;AAC5B,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,MAAM,IAAI,EAAE;AACZ,QAAQ,KAAK,EAAE,MAAM;AACrB,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,MAAM,KAAK,EAAE;AACb,QAAQ,KAAK,EAAE,OAAO;AACtB,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,MAAM,SAAS,EAAE;AACjB,QAAQ,KAAK,EAAE,WAAW;AAC1B,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,MAAM,MAAM,EAAE;AACd,QAAQ,KAAK,EAAE,QAAQ;AACvB,QAAQ,YAAY,EAAE,EAAE;AACxB,QAAQ,QAAQ,EAAE,EAAE;AACpB,OAAO;AACP,KAAK;AACL,IAAI,OAAO,EAAE,CAAC,SAAS,EAAE,SAAS,EAAE,YAAY,EAAE,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,QAAQ,CAAC;AACzF,GAAG;AACH;;ACrHA,MAAM,OAAO,GAAG;AAChB,EAAE,QAAQ,EAAE,CAAC,KAAK,EAAE,WAAW,CAAC;AAChC,EAAE,KAAK,EAAE;AACT,IAAI,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO;AACjH,GAAG;AACH,EAAE,EAAE,EAAE;AACN,IAAI,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO;AACrF,GAAG;AACH,EAAC;AACD;AACO,SAAS,KAAK,CAAC,aAAa,EAAE;AACrC,EAAE,OAAO,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,aAAa,CAAC;AACjD,CAAC;AACD;AACO,SAAS,OAAO,CAAC,aAAa,EAAE;AACvC,EAAE,MAAM,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,EAAC;AACvD,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,aAAa,EAAC;AACjD,EAAE,OAAO,OAAO,IAAI,IAAI;AACxB,CAAC;AACD;AACO,SAAS,YAAY,CAAC,aAAa,EAAE;AAC5C,EAAE,MAAM,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,aAAa,EAAC;AACvD,EAAE,MAAM,IAAI,GAAG,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,aAAa,EAAC;AACjD,EAAE,IAAI,OAAO,EAAE;AACf,IAAI,OAAO,KAAK;AAChB,GAAG,MAAM,IAAI,IAAI,EAAE;AACnB,IAAI,OAAO,IAAI;AACf,GAAG,MAAM;AACT,IAAI,OAAO,CAAC,KAAK,CAAC,qDAAqD,EAAC;AACxE,GAAG;AACH,CAAC;AAaD;AACO,SAAS,UAAU,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,GAAG,IAAI,EAAE,OAAO,GAAG,KAAK,EAAE;AACtE,EAAE,MAAM,KAAK,GAAG,EAAE,IAAI,CAAC,CAAC,CAAC,GAAE;AAC3B,EAAE,OAAO,KAAK,CAAC,MAAM,EAAE;AACvB,IAAI,MAAM,IAAI,GAAG,KAAK,CAAC,OAAO,GAAG,KAAK,GAAG,OAAO,CAAC,GAAE;AACnD,IAAI,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,KAAK,EAAE,OAAO,IAAI;AACxC,IAAI,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,QAAQ,EAAC;AACjD,GAAG;AACH,EAAE,OAAO,IAAI;AACb,CAAC;AAKD;AACA,SAAS,qBAAqB,CAAC,WAAW,EAAE;AAC5C;AACA;AACA;AACA,EAAE,MAAM,KAAK,GAAG,6BAA4B;AAC5C,EAAE,MAAM,IAAI,GAAG,WAAW,CAAC,KAAK,CAAC,KAAK,EAAC;AACvC,EAAE,IAAI,IAAI,IAAI,IAAI,CAAC,MAAM,EAAE;AAC3B,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,SAAS,KAAK;AAC1C;AACA,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;AACxB,QAAQ,SAAS,CAAC,KAAK,CAAC,GAAG,QAAQ,CAAC,CAAC,EAAE,EAAE,EAAC;AAC1C,OAAO;AACP,KAAK,EAAC;AACN,GAAG;AACH,EAAE,OAAO,IAAI;AACb,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,cAAc,CAAC,KAAK,EAAE,OAAO,GAAG,EAAE,EAAE;AACpD,CAAC,OAAO,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,KAAK,KAAK;AACvC;AACA,GAAG,MAAM,YAAY,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ,GAAE;AAC7C,EAAE,MAAM,kBAAkB,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,EAAC;AACjD;AACA,EAAE,MAAM,UAAU,GAAG,kBAAkB;AACvC,KAAK,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,KAAK,YAAY,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;AACrD,MAAM,YAAY,CAAC,QAAQ,CAAC,KAAK,EAAC;AAClC;AACA;AACA;AACA,IAAI,IAAI,OAAO,EAAE;AACjB,MAAM,MAAM,WAAW,GAAG,KAAK,CAAC,KAAK,IAAI,QAAO;AAChD,MAAM,OAAO,UAAU,IAAI,WAAW;AACtC,KAAK,MAAM;AACX,MAAM,OAAO,UAAU;AACvB,KAAK;AACL,GAAG,CAAC;AACJ,CAAC;AACD;AACA;AACA;AACA;AACA,MAAM,eAAe,GAAG,CAAC,SAAS,EAAE,OAAO,KAAK;AAChD,CAAC,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,GAAG;AAChC,EAAE,CAAC,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,KAAK,WAAW,IAAI,GAAG,CAAC,GAAG,CAAC,GAAG,SAAS,EAAE,SAAS,CAAC,CAAC;AACvE,EAAC;AAqBD;AACO,SAAS,YAAY,CAAC,YAAY,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE;AAClE,EAAE,IAAI,CAAC,YAAY,IAAI,CAAC,KAAK,GAAG;AAChC;AACA,IAAI,OAAO,SAAS;AACpB,GAAG,MAAM;AACT,IAAI,MAAM,IAAI,GAAG,qBAAqB,CAAC,YAAY,EAAC;AACpD,IAAI,MAAM,QAAQ,GAAG,eAAe,CAAC,KAAK,EAAE,IAAI,EAAC;AACjD,IAAI,MAAM,UAAU,GAAG,eAAe,CAAC,OAAO,EAAE,IAAI,EAAC;AACrD,IAAI,IAAI,OAAO,QAAQ,IAAI,QAAQ,IAAI,OAAO,UAAU,IAAI,QAAQ,EAAE;AACtE;AACA;AACA,MAAM,OAAO,SAAS;AACtB,KAAK,MAAM,IAAI,QAAQ,KAAK,UAAU,EAAE;AACxC;AACA,MAAM,OAAO,KAAK;AAClB,KAAK,MAAM;AACX;AACA,MAAM,OAAO,QAAQ,KAAK,KAAK;AAC/B,KAAK;AACL,GAAG;AACH;;ACjKA;AACA;AACA;AACO,eAAe,WAAW,EAAE,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,GAAG,SAAS,EAAE;AACrF;AACA,CAAC,IAAI,KAAK,IAAI,SAAS,EAAE,KAAK,GAAG,MAAMK,YAAI,CAAC,QAAQ,EAAC;AACrD;AACA,CAAC,MAAM,GAAG,GAAG;AACb,EAAE,IAAI,EAAE,KAAK;AACb,EAAE,IAAI,EAAE,EAAE;AACV,EAAE,IAAI,EAAE,QAAQ;AAChB,EAAE,EAAE,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;AACxB,EAAE,QAAQ,EAAE,QAAQ;AACpB,EAAE,OAAO,EAAE,KAAK,CAAC,SAAS,CAAC,WAAW,EAAE;AACxC,EAAE,QAAQ,EAAE,KAAK,CAAC,KAAK,CAAC,WAAW,EAAE;AACrC,EAAE,SAAS,EAAE,SAAS;AACtB;AACA,EAAE,KAAK,EAAE,EAAE;AACX,EAAE,OAAO,EAAE,EAAE;AACb,EAAE,IAAI,EAAE,EAAE;AACV,GAAE;AACF;AACA;AACA,CAAC,MAAM,EAAE,GAAGC,0BAAM,CAAC,IAAI,CAAC,QAAQ,EAAC;AACjC;AACA;AACA;AACA,CAAC,GAAG,CAAC,OAAO,GAAG,UAAU,CAAC,EAAE,CAAC,OAAO,EAAC;AACrC;AACA;AACA;AACA,CAAC,MAAM,cAAc,GAAG,CAAC,EAAE,CAAC,QAAO;AACnC,CAAC,IAAI,cAAc,EAAE;AACrB;AACA,EAAE,GAAG,CAAC,IAAI,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,GAAE;AAC/D,EAAE;AACF;AACA;AACA,CAAC,GAAG,CAAC,KAAK,GAAG,QAAQ,CAAC,EAAE,EAAEC,wBAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAC;AAClD,CAAC,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,MAAK;AACrB;AACA,CAAC,OAAO,GAAG;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,QAAQ,CAAC,UAAU,EAAE,QAAQ,EAAE;AACxC;AACA,CAAC,IAAI,WAAW,GAAG,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,WAAW,EAAC;AACxD,CAAC,IAAI,WAAW,EAAE;AAClB,EAAE,OAAO,WAAW,CAAC,CAAC,CAAC;AACvB,EAAE,MAAM,IAAI,UAAU,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;AACrD,EAAE,OAAO,UAAU,CAAC,IAAI,CAAC,KAAK;AAC9B,EAAE,MAAM;AACR,EAAE,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;AACrD,EAAE;AACF,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,UAAU,CAAC,OAAO,EAAE;AAC7B;AACA;AACA,CAAC,IAAI,OAAO,GAAG,OAAO;AACtB,GAAG,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC;AAC7B,GAAG,SAAS,CAAC,CAAC,EAAE,GAAG,EAAC;AACpB;AACA;AACA;AACA;AACA,CAAC,OAAO,GAAGC,4BAAQ,CAAC,OAAO,CAAC;AAC5B,GAAG,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;AACvB,GAAG,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;AACvB,GAAG,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;AACvB,GAAG,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;AACvB,GAAG,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;AAC5B,GAAG,OAAO,CAAC,aAAa,EAAE,GAAG,CAAC;AAC9B,GAAG,OAAO,CAAC,UAAU,EAAE,GAAG,CAAC;AAC3B,GAAG,SAAS,CAAC,CAAC,EAAE,GAAG,EAAC;AACpB;AACA,CAAC,OAAO,OAAO;AACf;;ACrGA;AACA;AACA;AACO,eAAe,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,KAAK,GAAG,SAAS,EAAE;AAClF;AACA,CAAC,IAAI,KAAK,IAAI,SAAS,EAAE,KAAK,GAAG,MAAMH,YAAI,CAAC,QAAQ,EAAC;AACrD,CAAC,MAAM,SAAS,GAAGE,wBAAI,CAAC,OAAO,CAAC,QAAQ,EAAC;AACzC,CAAC,MAAM,IAAI,GAAG,YAAY,CAAC,SAAS,EAAC;AACrC,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAGE,0BAAM,CAAC,QAAQ,EAAC;AACzD;AACA,CAAC,OAAO;AACR,EAAE,IAAI,EAAE,IAAI;AACZ,EAAE,IAAI,EAAEF,wBAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC;AAC/B,EAAE,IAAI,EAAE,QAAQ;AAChB,EAAE,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;AAC5B,EAAE,QAAQ,EAAE,QAAQ;AACpB,EAAE,OAAO,EAAE,KAAK,CAAC,SAAS,CAAC,WAAW,EAAE;AACxC,EAAE,QAAQ,EAAE,KAAK,CAAC,KAAK,CAAC,WAAW,EAAE;AACrC,EAAE,SAAS,EAAE,SAAS;AACtB;AACA,EAAE,MAAM,EAAE,MAAM;AAChB,EAAE,WAAW,EAAE,KAAK,CAAC,IAAI;AACzB,EAAE,UAAU,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE;AAC9C,EAAE;AACF;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAe,SAAS,CAAC,KAAK,EAAE,cAAc,EAAE,UAAU,EAAE,KAAK,GAAG,SAAS,EAAE,QAAQ,GAAG,EAAE,EAAE,SAAS,GAAG,CAAC,EAAE;AACpH;AACA;AACA;AACA,EAAE,IAAI,CAAC,KAAK,EAAE,KAAK,GAAG,MAAMF,YAAI,CAAC,UAAU,EAAC;AAC5C;AACA;AACA,EAAE,MAAM,MAAM,GAAG;AACjB,IAAI,IAAI,EAAE,QAAQ;AAClB,IAAI,IAAI,EAAE,UAAU,CAAC,SAAS,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC/D,IAAI,IAAI,EAAE,UAAU;AACpB,IAAI,EAAE,EAAE,CAAC,OAAO,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;AAC7B,IAAI,QAAQ,EAAE,QAAQ;AACtB,IAAI,OAAO,EAAE,KAAK,CAAC,SAAS,CAAC,WAAW,EAAE;AAC1C,IAAI,QAAQ,EAAE,KAAK,CAAC,KAAK,CAAC,WAAW,EAAE;AACvC,IAAI,SAAS,EAAE,SAAS;AACxB;AACA,IAAI,WAAW,EAAE,CAAC;AAClB,IAAI,cAAc,EAAE,CAAC;AACrB,IAAG;AACH;AACA;AACA,EAAE,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,OAAM;AAChC,EAAE,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,EAAC;AAC9B;AACA;AACA,EAAE,MAAM,QAAQ,GAAG;AACnB,IAAI,EAAE,EAAE,MAAM,CAAC,EAAE;AACjB,IAAI,QAAQ,EAAE,QAAQ;AACtB,IAAI,QAAQ,EAAE,EAAE;AAChB,IAAG;AACH,EAAE,cAAc,CAAC,IAAI,CAAC,QAAQ,EAAC;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,iBAAiB,GAAG,MAAMK,eAAO,CAAC,UAAU,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,EAAC;AAC9E;AACA,EAAE,MAAM,OAAO,CAAC,GAAG;AACnB,IAAI,iBAAiB,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK;AACvC;AACA;AACA,MAAM,MAAM,QAAQ,GAAGH,wBAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,IAAI,EAAC;AACpD;AACA;AACA,MAAM,MAAM,GAAG,GAAGA,wBAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAC;AACtC;AACA,MAAM,IAAI,CAAC,CAAC,WAAW,EAAE,EAAE;AAC3B;AACA,QAAQ,MAAM,EAAE,cAAc,EAAE,GAAG,MAAM,SAAS,CAAC,KAAK,EAAE,QAAQ,CAAC,QAAQ,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,CAAC,EAAE,EAAE,SAAS,GAAG,CAAC,EAAC;AAC3H;AACA;AACA,QAAQ,MAAM,CAAC,WAAW,GAAE;AAC5B,QAAQ,MAAM,CAAC,cAAc,IAAI,eAAc;AAC/C;AACA,OAAO,MAAM,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;AAC7C;AACA,QAAQ,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC;AAC/B,UAAU,MAAM,WAAW,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,EAAE,SAAS,GAAG,CAAC,CAAC;AAC/D,UAAU,MAAM,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,EAAE,EAAE,SAAS,GAAG,CAAC,EAAC;AAC5D;AACA,QAAQ,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;AAClC,QAAQ,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAC;AAClC,QAAQ,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC;AAC/B,UAAU,EAAE,EAAE,IAAI,CAAC,EAAE;AACrB,UAAU,QAAQ,EAAE,MAAM,CAAC,EAAE;AAC7B,SAAS,EAAC;AACV;AACA;AACA,QAAQ,MAAM,CAAC,WAAW,GAAE;AAC5B,OAAO;AACP,KAAK,CAAC;AACN,IAAG;AACH;AACA,EAAE,MAAM,CAAC,cAAc,IAAI,MAAM,CAAC,YAAW;AAC7C;AACA,EAAE,OAAO;AACT,IAAI,cAAc,EAAE,MAAM,CAAC,cAAc;AACzC,GAAG;AACH;;AClGA;AACA;AACA;AACA;AACO,eAAe,UAAU,EAAE,WAAW,EAAE;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI;AACN;AACA,IAAI,MAAM,KAAK,GAAG;AAClB,MAAM,IAAI,EAAE,EAAE;AACd,MAAM,IAAI,EAAE,EAAE;AACd,MAAM,MAAM,EAAE,EAAE;AAChB,MAAK;AACL;AACA;AACA,IAAI,MAAM,SAAS,CAAC,KAAK,EAAE,KAAK,CAAC,IAAI,EAAE,WAAW,EAAC;AACnD;AACA,IAAI,OAAO,KAAK;AAChB;AACA;AACA;AACA,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,CAAC,GAAG,CAAC,GAAG,EAAC;AACpB,GAAG;AACH;;ACtBAT,qBAAa,GAAE;AACf;AACO,MAAM,OAAO,CAAC;AACrB,EAAE,WAAW,CAAC,OAAO,EAAE;AACvB,IAAI,IAAI,CAAC,EAAE,GAAG,OAAO,CAAC,MAAM,CAAC,GAAE;AAC/B,IAAI,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,UAAS;AACtC,IAAI,IAAI,CAAC,KAAK,GAAG,GAAE;AACnB;AACA;AACA;AACA;AACA,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,KAAK,EAAE,QAAQ,KAAK;AACrD;AACA,MAAM,MAAM,SAAS,GAAG,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC,CAAC,UAAS;AACpF,MAAM,MAAM,kBAAkB,GAAG,SAAS,KAAK,GAAE;AACjD,MAAM,MAAM,iBAAiB,GAAG,IAAI,CAAC,SAAS,IAAI,GAAE;AACpD,MAAM,MAAM,mBAAmB,GAAG,SAAS,KAAK,IAAI,CAAC,UAAS;AAC9D;AACA,MAAM,IAAI,kBAAkB,EAAE;AAC9B,QAAQ,IAAI,iBAAiB,EAAE;AAC/B,UAAU,IAAI,CAAC,SAAS,GAAG,UAAS;AACpC,UAAU,IAAI,CAAC,KAAK,GAAE;AACtB,SAAS,MAAM,IAAI,mBAAmB,EAAE;AACxC,UAAU,IAAI,CAAC,MAAM,GAAE;AACvB,SAAS;AACT,OAAO;AACP,KAAK,EAAC;AACN;AACA,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;AACxB,MAAM,IAAI,CAAC,KAAK,GAAE;AAClB,KAAK;AACL,GAAG;AACH;AACA,EAAE,gBAAgB,GAAG,SAAS;AAC9B,EAAE,OAAO,GAAG,EAAE;AACd,EAAE,WAAW,GAAG,SAAS;AACzB,EAAE,SAAS,GAAG,EAAE;AAChB,EAAE,KAAK,GAAG,EAAE;AACZ,EAAE,EAAE,GAAG,CAAC;AACR;AACA,EAAE,MAAM,KAAK,GAAG;AAChB;AACA,IAAI,IAAI,CAAC,KAAK,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,SAAS,EAAC;AACjD;AACA;AACA,IAAI,IAAI,CAAC,gBAAgB,GAAGa,4BAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,cAAc,EAAC;AAC1E;AACA;AACA,IAAI,IAAI,CAAC,gBAAgB;AACzB,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACxE,OAAO,EAAE,CAAC,KAAK,EAAE,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AAClE,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACxE,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACxE,OAAO,EAAE,CAAC,WAAW,EAAE,CAAC,QAAQ,KAAK,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,QAAQ,CAAC,EAAC;AAC9E;AACA;AACA,IAAI,MAAM,GAAG,GAAGX,sBAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAC;AAC7C,IAAI,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,sBAAsB,EAAE,IAAI,CAAC,KAAK,EAAC;AAC5D,GAAG;AACH;AACA,EAAE,IAAI,GAAG;AACT;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,EAAE,YAAY,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE;AACvC,IAAI,MAAM,MAAM,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,GAAE;AACnD;AACA,IAAI,IAAI,KAAK,EAAE,MAAM,CAAC,KAAK,GAAG,MAAK;AACnC;AACA;AACA;AACA;AACA,IAAI,MAAM,aAAa,GAAG,KAAK,IAAI,QAAQ,GAAG,GAAG,GAAG,IAAG;AACvD;AACA;AACA;AACA,IAAI,IAAI,IAAI,CAAC,WAAW,IAAI,SAAS,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,EAAE,EAAE;AACrE,MAAM,IAAI,CAAC,OAAO,GAAG,CAAC,MAAM,EAAC;AAC7B,MAAM,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC,MAAM,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,aAAa,CAAC,CAAC;AAC1F,KAAK,MAAM;AACX,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,EAAC;AAC/B,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,GAAE;AAChC,KAAK;AACL,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,YAAY,CAAC,OAAO,EAAE;AAC9B;AACA,IAAI,MAAM,0BAA0B,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,IAAI,QAAQ,IAAI,CAAC,CAAC,KAAK,IAAI,WAAW,EAAC;AACzG;AACA,IAAI,IAAI,0BAA0B,EAAE;AACpC,MAAM,IAAI,CAAC,KAAK,GAAG,MAAM,UAAU,CAAC,IAAI,CAAC,SAAS,EAAC;AACnD,KAAK,MAAM;AACX,MAAM,IAAI,CAAC,KAAK,GAAG,MAAMD,2BAAO,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO,KAAK,KAAK;AAC9D,QAAQ,KAAK,MAAM,CAAC,IAAI,OAAO,EAAE;AACjC,UAAU,MAAM,GAAG,GAAGQ,wBAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAC;AAC1C,UAAU,MAAM,UAAU,GAAGA,wBAAI,CAAC,OAAO,CAAC,CAAC,CAAC,IAAI,EAAC;AACjD,UAAU,MAAM,YAAY,GAAG,aAAa,CAAC,KAAK,EAAE,UAAU,EAAC;AAC/D,UAAU,MAAM,cAAc,GAAG,UAAU,CAAC,KAAK,CAAC,IAAI,EAAE,YAAY,CAAC,EAAE,EAAE,IAAI,EAAC;AAC9E;AACA,UAAU,IAAI,KAAK,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;AAC1C;AACA,YAAY,QAAQ,CAAC,CAAC,KAAK;AAC3B,cAAc,KAAK,KAAK,EAAE;AAC1B,gBAAgB,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC;AACvC,kBAAkB,MAAM,WAAW,CAAC,CAAC,CAAC,IAAI,EAAE,YAAY,CAAC,EAAE,EAAE,YAAY,CAAC,SAAS,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC;AACjG,kBAAkB,MAAM,QAAQ,CAAC,CAAC,CAAC,IAAI,EAAE,YAAY,CAAC,EAAE,EAAE,YAAY,CAAC,SAAS,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,EAAC;AAC9F;AACA,gBAAgB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;AAC1C,gBAAgB,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAC;AAC1C,gBAAgB,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC;AAC7C,kBAAkB,EAAE,EAAE,IAAI,CAAC,EAAE;AAC7B,kBAAkB,QAAQ,EAAE,IAAI,CAAC,QAAQ;AACzC,kBAAkB,IAAI,EAAE,IAAI,CAAC,IAAI;AACjC,iBAAiB,EAAC;AAClB,gBAAgB,KAAK;AACrB,eAAe;AACf,cAAc,KAAK,QAAQ,EAAE;AAC7B,gBAAgB,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC;AACvC,kBAAkB,MAAM,WAAW,CAAC,CAAC,CAAC,IAAI,EAAE,YAAY,CAAC,EAAE,EAAE,YAAY,CAAC,SAAS,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC;AACjG,kBAAkB,MAAM,QAAQ,CAAC,CAAC,CAAC,IAAI,EAAE,YAAY,CAAC,EAAE,EAAE,YAAY,CAAC,SAAS,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,EAAC;AAC9F,gBAAgB,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,KAAI;AAC1C,gBAAgB,KAAK;AACrB,eAAe;AACf,cAAc,KAAK,QAAQ,EAAE;AAC7B,gBAAgB,MAAM,IAAI,GAAG,aAAa,CAAC,KAAK,EAAE,CAAC,CAAC,IAAI,EAAC;AACzD;AACA,gBAAgB,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAC;AAC1C,gBAAgB,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,EAAC;AAClD,gBAAgB,MAAM,eAAe,GAAG,cAAc,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,KAAK,KAAK,KAAK,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,EAAC;AACzG,gBAAgB,cAAc,CAAC,QAAQ,CAAC,MAAM,CAAC,eAAe,EAAE,CAAC,EAAC;AAClE,gBAAgB,KAAK;AACrB,eAAe;AACf,aAAa;AACb,WAAW;AACX,SAAS;AACT,OAAO,EAAE,CAAC,OAAO,EAAE,cAAc,KAAK;AACtC,QAAQ,MAAM,GAAG,GAAGP,sBAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAC;AACjD,QAAQ,OAAO,CAAC,GAAG,CAAC,OAAO,EAAC;AAC5B,QAAQ,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,sBAAsB,EAAE,OAAO,EAAC;AAC7D,OAAO,EAAC;AACR,KAAK;AACL,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,aAAa,CAAC,MAAM,EAAE,IAAI,EAAE;AACrC,EAAE,IAAI,IAAI,GAAG,GAAE;AACf,EAAE,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,KAAK,KAAK;AACpC,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,EAAE;AACtC,MAAM,IAAI,GAAG;AACb,QAAQ,EAAE,EAAE,EAAE;AACd,QAAQ,SAAS,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,SAAS;AAC5C,QAAQ,KAAK,EAAE,KAAK;AACpB,QAAO;AACP,MAAM,OAAO,IAAI;AACjB,KAAK;AACL,GAAG,EAAC;AACJ,EAAE,OAAO,IAAI;AACb,CAAC;AACD;AACA;AACA;AACA;AACA,MAAM,cAAc,GAAG;AACvB,EAAE,OAAO,EAAE,eAAe;AAC1B,EAAE,aAAa,EAAE,IAAI;AACrB,EAAE,UAAU,EAAE,IAAI;AAClB,EAAE,gBAAgB,EAAE;AACpB,IAAI,kBAAkB,EAAE,GAAG;AAC3B,IAAI,YAAY,EAAE,GAAG;AACrB,GAAG;AACH;;AC5LA;AACA;AACA;AACO,MAAM,WAAW,CAAC;AACzB,CAAC,WAAW,GAAG;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,KAAK,EAAE,QAAQ,KAAK;AACnD;AACA;AACA;AACA,GAAG,MAAM,uBAAuB,GAAG,cAAc,CAAC,CAAC,UAAU,EAAE,WAAW,CAAC,EAAC;AAC5E,GAAG,MAAM,YAAY,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,OAAM;AACxE,GAAG,MAAM,cAAc,GAAG,KAAK,CAAC,QAAQ,CAAC,MAAM,GAAG,QAAQ,CAAC,QAAQ,CAAC,OAAM;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,EAAC;AACJ,EAAE;AACF;AACA;AACA,CAAC,QAAQ,GAAG,EAAE;AACd;AACA;AACA;AACA;AACA,CAAC,MAAM,OAAO,GAAG;AAEjB,EAAE,KAAK,MAAM,OAAO,IAAI,MAAM,CAAC,KAAK,EAAE,CAAC,QAAQ,EAAE;AACjD;AACA;AACA,GAAG,MAAM,OAAO,GAAG,IAAI,OAAO,CAAC,OAAO,EAAC;AACvC,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAC;AAC9B,GAAG;AACH,EAAE;AACF;;ACnGe,yBAAc,CAAC,IAAI,EAAE;AACpC,EAAE,IAAI;AACN,EAAE,MAAMY,cAAM,CAAC,IAAI,EAAC;AACpB,EAAE,OAAO,EAAE,IAAI,EAAE,qBAAqB,EAAE,IAAI,EAAE,IAAI,EAAE;AACpD,EAAE,CAAC,MAAM,GAAG,EAAE;AACd,EAAE,OAAO,EAAE,IAAI,EAAE,kBAAkB,EAAE,GAAG,EAAE,GAAG,EAAE;AAC/C,EAAE;AACF;;ACPe,0BAAc,CAAC,KAAK,EAAE;AACrC,EAAE,IAAI;AACN,IAAI,IAAI,YAAY,GAAG,MAAM,OAAO,CAAC,GAAG;AACxC,MAAM,KAAK,CAAC,GAAG,CAAC,OAAO,IAAI,KAAK;AAChC,QAAQ,MAAMA,cAAM,CAAC,IAAI,EAAC;AAC1B,OAAO,CAAC;AACR,MAAK;AACL,EAAE,OAAO,EAAE,IAAI,EAAE,sBAAsB,EAAE,KAAK,EAAE,YAAY,EAAE;AAC9D,EAAE,CAAC,MAAM,GAAG,EAAE;AACd,EAAE,OAAO,EAAE,IAAI,EAAE,mBAAmB,EAAE,GAAG,EAAE,GAAG,EAAE;AAChD,EAAE;AACF;;ACXe,uBAAc,EAAE,IAAI,EAAE,IAAI,EAAE;AAC3C,CAAC,IAAI;AACL,EAAE,MAAMC,iBAAS,CAAC,IAAI,EAAE,IAAI,EAAE,MAAM,EAAC;AACrC,EAAE,OAAO;AACT,GAAG,IAAI,EAAE,mBAAmB;AAC5B,GAAG,IAAI,EAAE,IAAI;AACb,GAAG;AACH,EAAE,CAAC,OAAO,GAAG,EAAE;AACf,EAAE,OAAO;AACT,GAAG,IAAI,EAAE,gBAAgB;AACzB,GAAG,GAAG,EAAE,GAAG;AACX,GAAG;AACH,EAAE;AACF;;ACbe,6BAAc,IAAI;AACjC;AACA,EAAE,MAAM,GAAG,GAAGb,sBAAa,CAAC,gBAAgB,GAAE;AAC9C;AACA,EAAE,MAAM,SAAS,GAAG,MAAMc,eAAM,CAAC,cAAc,CAAC,GAAG,EAAE;AACrD,IAAI,KAAK,EAAE,uBAAuB;AAClC,IAAI,UAAU,EAAE,CAAC,eAAe,EAAE,iBAAiB,CAAC;AACpD,GAAG,EAAC;AACJ;AACA,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAAE;AAC3B,IAAI,OAAO,EAAE,IAAI,EAAE,uBAAuB,EAAE,SAAS,EAAE,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE;AAC/E,GAAG;AACH;;ACVO,MAAM,UAAU,CAAC;AACxB,EAAE,WAAW,GAAG;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIC,gBAAO,CAAC,EAAE,CAAC,YAAY,EAAE,CAAC,GAAG,KAAK;AACtC,MAAM,MAAM,GAAG,GAAGf,sBAAa,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,EAAC;AAC3D,MAAM,GAAG,CAAC,IAAI,GAAE;AAChB,KAAK,EAAC;AACN;AACA,IAAIe,gBAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,OAAO,GAAG,KAAK;AACnD,MAAM,MAAM,GAAG,GAAGf,sBAAa,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,EAAC;AAC3D,MAAM,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,UAAU,EAAE;AACtC,QAAQ,MAAM,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;AACpC,UAAU,IAAI,EAAE,gBAAgB;AAChC,SAAS,EAAE,GAAG,CAAC,EAAE,EAAC;AAClB,OAAO;AACP,MAAM,GAAG,CAAC,OAAO,GAAE;AACnB,KAAK,EAAC;AACN;AACA,IAAIe,gBAAO,CAAC,EAAE,CAAC,UAAU,EAAE,OAAO,GAAG,EAAE,MAAM,KAAK;AAClD,MAAM,MAAM,GAAG,GAAGf,sBAAa,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,EAAC;AAC3D,MAAM,QAAQ,MAAM,CAAC,IAAI;AACzB,QAAQ,MAAM,0BAA0B;AACxC,UAAU,KAAK,CAAC,QAAQ,CAAC,MAAM,cAAc,EAAE,EAAE,GAAG,CAAC,EAAE,EAAC;AACxD,UAAU,KAAK;AACf,QAAQ,MAAM,WAAW;AACzB,UAAU,KAAK,CAAC,QAAQ,CAAC,MAAM,QAAQ,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,EAAE,EAAC;AAC1E,UAAU,KAAK;AACf,QAAQ,MAAM,aAAa;AAC3B,UAAU,KAAK,CAAC,QAAQ,CAAC,MAAM,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC,EAAE,EAAC;AAC/D,UAAU,KAAK;AACf,QAAQ,MAAM,cAAc;AAC5B,UAAU,KAAK,CAAC,QAAQ,CAAC,MAAM,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,GAAG,CAAC,EAAE,EAAC;AACjE,UAAU,KAAK;AACf,QAAQ;AACR,UAAU,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,GAAG,CAAC,EAAE,EAAC;AACxC,UAAU,KAAK;AACf,OAAO;AACP,KAAK,EAAC;AACN;AACA;AACA;AACA,IAAIe,gBAAO,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC,GAAG,KAAK;AACxC,MAAM,OAAO,MAAM,CAAC,KAAK,EAAE;AAC3B,KAAK,EAAC;AACN;AACA,IAAIA,gBAAO,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC,GAAG,KAAK;AACxC,MAAM,MAAM,GAAG,GAAGf,sBAAa,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,EAAC;AAC3D,MAAM,MAAM,OAAO,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,OAAO,KAAK,OAAO,CAAC,EAAE,IAAI,GAAG,CAAC,EAAE,EAAC;AAC7E,MAAM,OAAO,OAAO,CAAC,KAAK;AAC1B,KAAK,EAAC;AACN,GAAG;AACH,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrQO,MAAM,cAAc,CAAC;AAC5B,EAAE,WAAW,GAAG;AAChB;AACA,IAAI,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,QAAQ,KAAK,SAAQ;AAC9C,IAAI,IAAI,CAAC,SAAS,GAAG,GAAE;AACvB;AACA;AACA,IAAI,MAAM,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,KAAK,EAAE,QAAQ,KAAK;AACrD;AACA;AACA;AACA,KAAK,EAAC;AACN;AACA;AACA,IAAI,IAAI,CAAC,UAAU,GAAE;AACrB,GAAG;AACH;AACA,EAAE,UAAU,GAAG;AACf,IAAIgB,aAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,OAAO,EAAE,EAAC;AAC3C,GAAG;AACH;AACA,EAAE,MAAM,GAAG;AACX;AACA,GAAG;AACH;AACA,EAAE,OAAO,GAAG;AACZ,IAAI,MAAM,IAAI,GAAG,IAAIA,aAAI,GAAE;AAC3B,IAAI,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,YAAY,GAAE;AACxC,IAAI,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,OAAO,C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"}